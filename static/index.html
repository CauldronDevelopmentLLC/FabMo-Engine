<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Shopbot Example App</title>
  <!-- From bootstrap -->
  <link rel="stylesheet" href="static/css/bootstrap.min.css">
  <link rel="stylesheet" href="static/css/normalize.css">
  <link rel="stylesheet" href="static/css/style.css">
</head>
<body>
    <nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="brand" href="#"><img src="static/images/shopbot_logo.png"></a>
      </div>

      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
          <li><a><span class="label status-label label-default tool-state">&nbsp;</span></a></li>
          <li><a><strong>X: </strong><span class="xpos"></span></a></li>
          <li><a><strong>Y: </strong><span class="ypos"></span></a></li>
          <li><a><strong>Z: </strong><span class="zpos"></span></a></li>
        </ul>

        <button type="button" class="btn btn-danger navbar-btn navbar-right stop-button hide">STOP TOOL</button>
      </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
  </nav>

  <div class="container">

    <div class="panel panel-default">
      <div class="panel-heading app-heading">Shopbot G-Code Streamer</div>
      <div class="panel-body">
        
        <p>
        This is a simple application for streaming a G-Code file.
        </p>
        

        
        <table class="table table-hover table-bordered" id="files">
          <tr><th>Files on the tool (click to run)</th></tr>
        </table>

        <strong>Upload a file...</strong>
        <p>
          <form action="/upload" method="post" enctype="multipart/form-data">
            <div class="pull-left">
          <input type="file" name="file" data-filename-placement="inside" title="Browse for a file to upload...">
        </div>
        <div class="pull-right">
          <input type="submit" value="Upload" class="btn btn-default btn-primary">
          </div>
          </form>
        </p>

      </div>
    </div>

  </div>

  <script src="static/js/libs/jquery-1.10.2.js"></script>
  <script src="static/js/bootstrap.min.js"></script>
  <script src="static/js/libs/bootstrap.file-input.js"></script>
  <script type="text/javascript">
    $(document).ready(function(){

      // Style the file input so it looks nice
      $('input[type=file]').bootstrapFileInput();

      // Load the list of files available on the tool
      $.getJSON( "/files", function( data ) {
        $.each( data.files, function( key, val ) {
          $("#files").append( "<tr><td id='file" + key + "'><a href='/run_file?id=" + val + "' >" + key + "</a></td></tr>" );
        });
      });
    timer();
    });

    function timer() {
      $.getJSON( "/status", function( data ) {
        $('.xpos').html(data.status.xpos.toFixed(3));
        $('.ypos').html(data.status.ypos.toFixed(3));
        $('.zpos').html(data.status.zpos.toFixed(3));
        if(data.status.state == 'idle') {
          $('.status-label').removeClass('label-success');
          $('.status-label').addClass('label-default');
          $('.tool-state').html('Tool State: Idle');
          $('.stop-button').addClass('hide');
        } else {
          $('.status-label').removeClass('label-default');
          $('.status-label').addClass('label-success');         
          $('.tool-state').html('Tool State: Running');
          $('.stop-button').removeClass('hide');
        }
      });
      setTimeout(timer, 500);
    }

    $('.stop-button').click(function() {
      $.getJSON("/stop", function(data) {});
    });
  </script>

</body>
</html>
