<!DOCTYPE html><html lang="en"><head><title>test/test_config</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="test/test_config"><meta name="groc-project-path" content="test/test_config.js"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">test/test_config.js</div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> assert = <span class="hljs-built_in">require</span>(<span class="hljs-string">"assert"</span>);
<span class="hljs-keyword">var</span> async = <span class="hljs-built_in">require</span>(<span class="hljs-string">"async"</span>)
<span class="hljs-keyword">var</span> config = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../config"</span>);
<span class="hljs-keyword">var</span> base = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./test_base"</span>);

describe(<span class="hljs-string">'Config Module'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>

	it(<span class="hljs-string">'Update G2 config with a valid value'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span>{</span>
		<span class="hljs-keyword">var</span> expected = {<span class="hljs-string">'xsn'</span>:<span class="hljs-number">1</span>};
		config.driver.update(expected, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, result)</span> {</span>
			<span class="hljs-keyword">if</span>(err) { done(err); }
			assert.equal(result.st, expected.st)
			<span class="hljs-keyword">return</span> done();
		});
	});

	it(<span class="hljs-string">'Update G2 config with an invalid value'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span>{</span>
		<span class="hljs-keyword">var</span> expected = {<span class="hljs-string">'st'</span>:<span class="hljs-string">'carrot'</span>};
		config.driver.update(expected, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, result)</span> {</span>
			<span class="hljs-keyword">if</span>(err) { done(err); }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>We expect G2 to swallow the carrot and replace it with zero</p></div></div><div class="code"><div class="wrapper">			assert.equal(result.st, <span class="hljs-number">0</span>)
			<span class="hljs-keyword">return</span> done();
		});
	});

	it(<span class="hljs-string">'Update G2 config with multiple values'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span>{</span>
		<span class="hljs-keyword">var</span> expected = {<span class="hljs-string">'xsn'</span>:<span class="hljs-number">1</span>, <span class="hljs-string">'ysn'</span>:<span class="hljs-number">1</span>};
		config.driver.update(expected, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, result)</span> {</span>
			<span class="hljs-keyword">if</span>(err) { done(err); }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>We expect G2 to swallow the carrot and replace it with zero</p></div></div><div class="code"><div class="wrapper">			assert.equal(result.xsn, <span class="hljs-number">1</span>)
			assert.equal(result.ysn, <span class="hljs-number">1</span>)
			<span class="hljs-keyword">return</span> done();
		});
	});

	it(<span class="hljs-string">'Update OpenSBP config'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span>{</span>
		<span class="hljs-keyword">var</span> expected = {<span class="hljs-string">'safeZPullup'</span>:<span class="hljs-number">0.5</span>};
		config.opensbp.update(expected, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, result)</span> {</span>
			<span class="hljs-keyword">if</span>(err) { done(err); }
			assert.equal(result.safeZPullup, expected.safeZPullup)
			<span class="hljs-keyword">return</span> done();
		});
	});

	it(<span class="hljs-string">'Read OpenSBP config'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span>{</span>
		<span class="hljs-keyword">var</span> expected = <span class="hljs-number">0.5</span>;
		<span class="hljs-keyword">var</span> actual = config.opensbp.get(<span class="hljs-string">'safeZPullup'</span>)
		assert.equal(actual, expected)
		<span class="hljs-keyword">return</span> done();
	});

	it(<span class="hljs-string">'Read OpenSBP config (multiple)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span>{</span>
		<span class="hljs-keyword">var</span> actual = config.opensbp.getMany([<span class="hljs-string">'safeZPullup'</span>,<span class="hljs-string">'safeApullUp'</span>]);
		<span class="hljs-keyword">return</span> done();
	});
});</div></div></div></div></body></html>