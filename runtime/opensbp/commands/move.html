<!DOCTYPE html><html lang="en"><head><title>runtime/opensbp/commands/move</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../../"><meta name="groc-document-path" content="runtime/opensbp/commands/move"><meta name="groc-project-path" content="runtime/opensbp/commands/move.js"><link rel="stylesheet" type="text/css" media="all" href="../../../assets/style.css"><script type="text/javascript" src="../../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">runtime/opensbp/commands/move.js</div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> log = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../../log'</span>).logger(<span class="hljs-string">'sbp'</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>var g2 = require(&#39;../../../g2&#39;);
var sb3_commands = require(&#39;../sb3_commands&#39;);</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> config = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../../config'</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>...TESTING::th aliased macros concept ... Bender: commands (hardcoded here at moment)</p></div></div><div class="code"><div class="wrapper">exports._A = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">args, callback</span>) </span>{
	<span class="hljs-keyword">var</span> alias_name = args[<span class="hljs-number">0</span>];

	log.debug( <span class="hljs-string">" _A args: "</span> + <span class="hljs-built_in">JSON</span>.stringify(args));
	<span class="hljs-keyword">if</span>(alias_name == <span class="hljs-string">"BEND"</span>) { <span class="hljs-keyword">this</span>.runCustomCut(<span class="hljs-string">'31'</span>,callback); }
	<span class="hljs-keyword">if</span>(alias_name == <span class="hljs-string">"FEED"</span>) { <span class="hljs-keyword">this</span>.runCustomCut(<span class="hljs-string">'32'</span>,callback); }
	<span class="hljs-keyword">if</span>(alias_name == <span class="hljs-string">"HOME"</span>) { <span class="hljs-keyword">this</span>.runCustomCut(<span class="hljs-string">'35'</span>,callback); }
	<span class="hljs-keyword">if</span>(alias_name == <span class="hljs-string">"CONFIGURE"</span>) { <span class="hljs-keyword">this</span>.runCustomCut(<span class="hljs-string">'36'</span>,callback); }
};</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Move X axis</p></div></div><div class="code"><div class="wrapper">exports.MX = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) </span>{
    <span class="hljs-keyword">var</span> x = args[<span class="hljs-number">0</span>];
	<span class="hljs-keyword">if</span> ( x !== <span class="hljs-keyword">this</span>.cmd_posx ){
		<span class="hljs-keyword">if</span>(<span class="hljs-built_in">isNaN</span>(x)) { <span class="hljs-keyword">throw</span>( <span class="hljs-string">"Invalid MX argument: "</span> + x ); }
		<span class="hljs-keyword">var</span> feedrate = <span class="hljs-keyword">this</span>.movespeed_xy * <span class="hljs-number">60</span>;
		<span class="hljs-keyword">this</span>.cmd_posx = x;
		<span class="hljs-keyword">this</span>.emit_move(<span class="hljs-string">'G1'</span>,{<span class="hljs-string">"X"</span>:x,<span class="hljs-string">'F'</span>:feedrate});
	}
};</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Move Y axis</p></div></div><div class="code"><div class="wrapper">exports.MY = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) </span>{
	<span class="hljs-keyword">var</span> y = args[<span class="hljs-number">0</span>];
	<span class="hljs-keyword">if</span> ( y !== <span class="hljs-keyword">this</span>.cmd_posy ){
		<span class="hljs-keyword">if</span>(<span class="hljs-built_in">isNaN</span>(y)) { <span class="hljs-keyword">throw</span>( <span class="hljs-string">"Invalid MY argument: "</span> + y ); }
		<span class="hljs-keyword">var</span> feedrate = <span class="hljs-keyword">this</span>.movespeed_xy * <span class="hljs-number">60</span>;
		<span class="hljs-keyword">this</span>.cmd_posy = y;
		<span class="hljs-keyword">this</span>.emit_move(<span class="hljs-string">'G1'</span>,{<span class="hljs-string">"Y"</span>:y,<span class="hljs-string">'F'</span>:feedrate});
	}
};</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Move Z axis</p></div></div><div class="code"><div class="wrapper">exports.MZ = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) </span>{
	<span class="hljs-keyword">var</span> z = args[<span class="hljs-number">0</span>];
	<span class="hljs-keyword">if</span> ( z !== <span class="hljs-keyword">this</span>.cmd_posz ){
		<span class="hljs-keyword">if</span>(<span class="hljs-built_in">isNaN</span>(z)) { <span class="hljs-keyword">throw</span>( <span class="hljs-string">"Invalid MZ argument: "</span> + z ); }
		<span class="hljs-keyword">var</span> feedrate = <span class="hljs-keyword">this</span>.movespeed_z * <span class="hljs-number">60</span>;
		<span class="hljs-keyword">this</span>.cmd_posz =  z;
		<span class="hljs-keyword">this</span>.emit_move(<span class="hljs-string">'G1'</span>,{<span class="hljs-string">"Z"</span>:z,<span class="hljs-string">'F'</span>:feedrate});
	}
};</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Move A axis</p></div></div><div class="code"><div class="wrapper">exports.MA = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) </span>{
	<span class="hljs-keyword">var</span> a = args[<span class="hljs-number">0</span>];
	<span class="hljs-keyword">if</span> ( a !== <span class="hljs-keyword">this</span>.cmd_posa ){
		<span class="hljs-keyword">if</span>(<span class="hljs-built_in">isNaN</span>(a)) { <span class="hljs-keyword">throw</span>( <span class="hljs-string">"Invalid MA argument: "</span> + a ); }
		<span class="hljs-keyword">var</span> feedrate = <span class="hljs-keyword">this</span>.movespeed_a * <span class="hljs-number">60</span>;
		<span class="hljs-keyword">this</span>.cmd_posa = a;
		<span class="hljs-keyword">this</span>.emit_move(<span class="hljs-string">'G1'</span>,{<span class="hljs-string">"A"</span>:a,<span class="hljs-string">'F'</span>:feedrate});
	}
};</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Move B axis</p></div></div><div class="code"><div class="wrapper">exports.MB = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) </span>{
	<span class="hljs-keyword">var</span> b = args[<span class="hljs-number">0</span>];
	<span class="hljs-keyword">if</span> ( b !== <span class="hljs-keyword">this</span>.cmd_posb ){
		<span class="hljs-keyword">if</span>(<span class="hljs-built_in">isNaN</span>(b)) { <span class="hljs-keyword">throw</span>( <span class="hljs-string">"Invalid MB argument: "</span> + b ); }
		<span class="hljs-keyword">var</span> feedrate = <span class="hljs-keyword">this</span>.movespeed_b * <span class="hljs-number">60</span>;
		<span class="hljs-keyword">this</span>.cmd_posb = b;
		<span class="hljs-keyword">this</span>.emit_move(<span class="hljs-string">'G1'</span>,{<span class="hljs-string">"B"</span>:b,<span class="hljs-string">'F'</span>:feedrate});
	}
};</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Move C axis</p></div></div><div class="code"><div class="wrapper">exports.MC = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) </span>{
	<span class="hljs-keyword">var</span> c = args[<span class="hljs-number">0</span>];
	<span class="hljs-keyword">if</span> ( c !== <span class="hljs-keyword">this</span>.cmd_posc ){
		<span class="hljs-keyword">if</span>(<span class="hljs-built_in">isNaN</span>(c)) { <span class="hljs-keyword">throw</span>( <span class="hljs-string">"Invalid MC argument: "</span> + c ); }
		<span class="hljs-keyword">var</span> feedrate = <span class="hljs-keyword">this</span>.movespeed_c * <span class="hljs-number">60</span>;
		<span class="hljs-keyword">this</span>.cmd_posc = c;
		<span class="hljs-keyword">this</span>.emit_move(<span class="hljs-string">'G1'</span>,{<span class="hljs-string">"C"</span>:c,<span class="hljs-string">'F'</span>:feedrate});
	}
};</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Move 2 axes (XY). This is a modal command, any axis location that is left out
  of the command will default to it&#39;s current position and not move</p></div></div><div class="code"><div class="wrapper">exports.M2 = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) </span>{
	log.debug(<span class="hljs-string">"  X param = "</span> + args[<span class="hljs-number">0</span>] + <span class="hljs-string">"  Y param = "</span> + args[<span class="hljs-number">1</span>]);
    <span class="hljs-keyword">var</span> params = process_move.bind(<span class="hljs-keyword">this</span>)(args);
    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.cmd_result &lt; <span class="hljs-number">2</span> ){
		<span class="hljs-keyword">this</span>.emit_move(<span class="hljs-string">'G1'</span>,params);
	}
};</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Move 3 axes (XYZ). This is a modal command, any axis location that is left out
  of the command will default to it&#39;s current position and not move</p></div></div><div class="code"><div class="wrapper">exports.M3 = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) </span>{
    <span class="hljs-keyword">var</span> params = process_move.bind(<span class="hljs-keyword">this</span>)(args);
    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.cmd_result &lt; <span class="hljs-number">3</span> ){
		<span class="hljs-keyword">this</span>.emit_move(<span class="hljs-string">'G1'</span>,params);
	}
};</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Move 4 axes (XYZA). This is a modal command, any axis location that is left out
  of the command will default to it&#39;s current position and not move</p></div></div><div class="code"><div class="wrapper">exports.M4 = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) </span>{
    <span class="hljs-keyword">var</span> params = process_move.bind(<span class="hljs-keyword">this</span>)(args);
    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.cmd_result &lt; <span class="hljs-number">4</span> ){
		<span class="hljs-keyword">this</span>.emit_move(<span class="hljs-string">'G1'</span>,params);
	}
};</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Move 5 axes (XYZAB). This is a modal command, any axis location that is left out
  of the command will default to it&#39;s current position and not move</p></div></div><div class="code"><div class="wrapper">exports.M5 = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) </span>{
    <span class="hljs-keyword">var</span> params = process_move.bind(<span class="hljs-keyword">this</span>)(args);
    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.cmd_result &lt; <span class="hljs-number">5</span> ){
		<span class="hljs-keyword">this</span>.emit_move(<span class="hljs-string">'G1'</span>,params);
	}
};</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Move all 6 axes (XYZABC). This is a modal command, any axis location that is left out
  of the command will default to it&#39;s current position and not move</p></div></div><div class="code"><div class="wrapper">exports.M6 = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) </span>{
    <span class="hljs-keyword">var</span> params = process_move.bind(<span class="hljs-keyword">this</span>)(args);
    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.cmd_result &lt; <span class="hljs-number">6</span> ){
		<span class="hljs-keyword">this</span>.emit_move(<span class="hljs-string">'G1'</span>,params);
	}
};

process_move = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) </span>{
	<span class="hljs-keyword">this</span>.cmd_result = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">var</span> params = {};
	<span class="hljs-keyword">var</span> feedrate = <span class="hljs-keyword">this</span>.movespeed_xy * <span class="hljs-number">60</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>log.debug(&quot;    (process_move)movespeed_xy = &quot; + this.movespeed_xy);</p></div></div><div class="code"><div class="wrapper">	<span class="hljs-keyword">if</span>( args[<span class="hljs-number">0</span>] === <span class="hljs-number">0</span> || args[<span class="hljs-number">0</span>] &amp;&amp; <span class="hljs-keyword">typeof</span> args[<span class="hljs-number">0</span>] === <span class="hljs-string">"number"</span>){  <span class="hljs-comment">//args[0] === 0 ||</span>
		params.X = args[<span class="hljs-number">0</span>];
		<span class="hljs-keyword">if</span> ( params.X === <span class="hljs-keyword">this</span>.cmd_posx ) { <span class="hljs-keyword">this</span>.cmd_result += <span class="hljs-number">1</span>; }
	}
	<span class="hljs-keyword">if</span>( args[<span class="hljs-number">1</span>] === <span class="hljs-number">0</span> || args[<span class="hljs-number">1</span>] &amp;&amp; <span class="hljs-keyword">typeof</span> args[<span class="hljs-number">1</span>] === <span class="hljs-string">"number"</span>){  <span class="hljs-comment">//args[1] === 0 ||</span>
		params.Y = args[<span class="hljs-number">1</span>];
		<span class="hljs-keyword">if</span> ( params.Y === <span class="hljs-keyword">this</span>.cmd_posy ) { <span class="hljs-keyword">this</span>.cmd_result += <span class="hljs-number">1</span>; }
	}
	<span class="hljs-keyword">if</span>(args[<span class="hljs-number">2</span>] === <span class="hljs-number">0</span> || args[<span class="hljs-number">2</span>] &amp;&amp; <span class="hljs-keyword">typeof</span> args[<span class="hljs-number">2</span>] === <span class="hljs-string">"number"</span>){
		params.Z = args[<span class="hljs-number">2</span>];
		<span class="hljs-keyword">if</span> ( params.Z === <span class="hljs-keyword">this</span>.cmd_posz ) { <span class="hljs-keyword">this</span>.cmd_result += <span class="hljs-number">1</span>; }
	}
	<span class="hljs-keyword">if</span>(args[<span class="hljs-number">3</span>] === <span class="hljs-number">0</span> || args[<span class="hljs-number">3</span>] &amp;&amp; <span class="hljs-keyword">typeof</span> args[<span class="hljs-number">3</span>] === <span class="hljs-string">"number"</span>){
		params.A = args[<span class="hljs-number">3</span>];
		<span class="hljs-keyword">if</span> ( params.A === <span class="hljs-keyword">this</span>.cmd_posa ) { <span class="hljs-keyword">this</span>.cmd_result += <span class="hljs-number">1</span>; }
	}
	<span class="hljs-keyword">if</span>(args[<span class="hljs-number">4</span>] === <span class="hljs-number">0</span> || args[<span class="hljs-number">4</span>] &amp;&amp; <span class="hljs-keyword">typeof</span> args[<span class="hljs-number">4</span>] === <span class="hljs-string">"number"</span>){
		params.B = args[<span class="hljs-number">4</span>];
		<span class="hljs-keyword">if</span> ( params.B === <span class="hljs-keyword">this</span>.cmd_posb ) { <span class="hljs-keyword">this</span>.cmd_result += <span class="hljs-number">1</span>; }
	}
	<span class="hljs-keyword">if</span>(args[<span class="hljs-number">5</span>] === <span class="hljs-number">0</span> || args[<span class="hljs-number">5</span>] &amp;&amp; <span class="hljs-keyword">typeof</span> args[<span class="hljs-number">5</span>] === <span class="hljs-string">"number"</span>){
		params.C = args[<span class="hljs-number">5</span>];
		<span class="hljs-keyword">if</span> ( params.C === <span class="hljs-keyword">this</span>.cmd_posc ) { <span class="hljs-keyword">this</span>.cmd_result += <span class="hljs-number">1</span>; }
	}
	params.F = feedrate;

	<span class="hljs-keyword">return</span> params;
};</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Move to the XY home position (0,0)</p></div></div><div class="code"><div class="wrapper">exports.MH = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) </span>{
	<span class="hljs-keyword">var</span> x = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">var</span> y = <span class="hljs-number">0</span>;
 	<span class="hljs-keyword">var</span> z = <span class="hljs-keyword">this</span>.cmd_posz;
	<span class="hljs-keyword">var</span> safeZ = config.opensbp.get(<span class="hljs-string">'safeZpullUp'</span>);
	<span class="hljs-keyword">var</span> feedrateXY = <span class="hljs-keyword">this</span>.movespeed_xy * <span class="hljs-number">60</span>;
	<span class="hljs-keyword">var</span> feedrateZ = <span class="hljs-keyword">this</span>.movespeed_z * <span class="hljs-number">60</span>;

	log.debug( <span class="hljs-string">"MH"</span> );
	<span class="hljs-keyword">if</span> ( z &lt; safeZ ){
		<span class="hljs-keyword">this</span>.emit_move(<span class="hljs-string">'G1'</span>,{<span class="hljs-string">"Z"</span>:safeZ,<span class="hljs-string">'F'</span>:feedrateZ});
		<span class="hljs-keyword">this</span>.emit_move(<span class="hljs-string">'G1'</span>,{<span class="hljs-string">"X"</span>:x,<span class="hljs-string">"Y"</span>:y,<span class="hljs-string">'F'</span>:feedrateXY});
 	}
 	<span class="hljs-keyword">else</span>{
 		<span class="hljs-keyword">this</span>.emit_move(<span class="hljs-string">'G1'</span>,{<span class="hljs-string">"X"</span>:x,<span class="hljs-string">"Y"</span>:y,<span class="hljs-string">'F'</span>:feedrateXY});
 	}
	<span class="hljs-keyword">this</span>.cmd_posx = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">this</span>.cmd_posy = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">this</span>.cmd_posz = safeZ;
};</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Set the Move (cut) speed for any of the 6 axes
   The changes to speed made by this command are not permanent</p>
<ul>
<li>use the SV command to make these changes permanent</li>
</ul></div></div><div class="code"><div class="wrapper">exports.MS = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">args, callback</span>) </span>{
	<span class="hljs-keyword">var</span> speed_change = <span class="hljs-number">0.0</span>;

	<span class="hljs-keyword">if</span> (args[<span class="hljs-number">0</span>] !== <span class="hljs-literal">undefined</span>) {
		speed_change = args[<span class="hljs-number">0</span>];
		<span class="hljs-keyword">if</span>(<span class="hljs-built_in">isNaN</span>(speed_change)) { <span class="hljs-keyword">throw</span>( <span class="hljs-string">"Invalid MS-XY argument: "</span> + speed_change ); }
		<span class="hljs-keyword">this</span>.movespeed_xy = speed_change;
	}
	<span class="hljs-keyword">if</span> (args[<span class="hljs-number">1</span>] !== <span class="hljs-literal">undefined</span>) {
		speed_change = args[<span class="hljs-number">1</span>];
		<span class="hljs-keyword">if</span>(<span class="hljs-built_in">isNaN</span>(speed_change)) { <span class="hljs-keyword">throw</span>( <span class="hljs-string">"Invalid MS-Z argument: "</span> + speed_change ); }
		<span class="hljs-keyword">this</span>.movespeed_z = speed_change;
	}
	<span class="hljs-keyword">if</span> (args[<span class="hljs-number">2</span>] !== <span class="hljs-literal">undefined</span>) {
		speed_change = args[<span class="hljs-number">2</span>];
		<span class="hljs-keyword">if</span>(<span class="hljs-built_in">isNaN</span>(speed_change)) { <span class="hljs-keyword">throw</span>( <span class="hljs-string">"Invalid MS-A argument: "</span> + speed_change ); }
		<span class="hljs-keyword">this</span>.movespeed_a = speed_change;
	}
	<span class="hljs-keyword">if</span> (args[<span class="hljs-number">3</span>] !== <span class="hljs-literal">undefined</span>) {
		speed_change = args[<span class="hljs-number">3</span>];
		<span class="hljs-keyword">if</span>(<span class="hljs-built_in">isNaN</span>(speed_change)) { <span class="hljs-keyword">throw</span>( <span class="hljs-string">"Invalid MS-B argument: "</span> + speed_change ); }
		<span class="hljs-keyword">this</span>.movespeed_b = speed_change;
	}
	<span class="hljs-keyword">if</span> (args[<span class="hljs-number">4</span>] !== <span class="hljs-literal">undefined</span>) {
		speed_change = args[<span class="hljs-number">4</span>];
		<span class="hljs-keyword">if</span>(<span class="hljs-built_in">isNaN</span>(speed_change)) { <span class="hljs-keyword">throw</span>( <span class="hljs-string">"Invalid MS-C argument: "</span> + speed_change ); }
		<span class="hljs-keyword">this</span>.movespeed_c = speed_change;
	}

    <span class="hljs-keyword">this</span>.vs_change = <span class="hljs-number">1</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>   log.debug(&quot;  MS: vs_change = &quot; + this.vs_change);</p></div></div><div class="code"><div class="wrapper">    callback();

};

exports.MO = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) </span>{
	<span class="hljs-comment">//?????????????????????????????????????????????</span>
};</div></div></div></div></body></html>