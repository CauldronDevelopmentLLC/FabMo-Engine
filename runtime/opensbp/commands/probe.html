<!DOCTYPE html><html lang="en"><head><title>runtime/opensbp/commands/probe</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../../"><meta name="groc-document-path" content="runtime/opensbp/commands/probe"><meta name="groc-project-path" content="runtime/opensbp/commands/probe.js"><link rel="stylesheet" type="text/css" media="all" href="../../../assets/style.css"><script type="text/javascript" src="../../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">runtime/opensbp/commands/probe.js</div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> log = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../../log'</span>).logger(<span class="hljs-string">'sbp'</span>);
<span class="hljs-keyword">var</span> g2 = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../../g2'</span>);
<span class="hljs-keyword">var</span> sb3_commands = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../sb3_commands'</span>);
<span class="hljs-keyword">var</span> config = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../../config'</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Generic probe function
opts:
 inp : input number (int)
 dist : map of axis word (X,Y,Z,A,B,C) to search distance
 feed : feedrate in units/sec</p></div></div><div class="code"><div class="wrapper"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">probe</span>(<span class="hljs-params">runtime, opts</span>) </span>{

	<span class="hljs-keyword">var</span> name = <span class="hljs-string">'di'</span> + opts.inp + <span class="hljs-string">'fn'</span>;

	<span class="hljs-keyword">var</span> cmd1 = {};
	cmd1[name] = <span class="hljs-number">4</span>

	<span class="hljs-keyword">var</span> cmd2 = [<span class="hljs-string">'G38.2'</span>]
	<span class="hljs-keyword">for</span>(word <span class="hljs-keyword">in</span> opts.dist) {
		cmd2.push(word + opts.dist[word].toFixed(<span class="hljs-number">5</span>))
	}

    <span class="hljs-keyword">var</span> cmd3 = {}
    cmd3[name] = <span class="hljs-number">0</span>

    cmd2.push(<span class="hljs-string">'F'</span> + (opts.feed*<span class="hljs-number">60.0</span>).toFixed(<span class="hljs-number">3</span>))
	runtime.emit_gcode(<span class="hljs-string">'M100.1('</span> + <span class="hljs-built_in">JSON</span>.stringify(cmd1) + <span class="hljs-string">')'</span>);
	runtime.emit_gcode(cmd2.join(<span class="hljs-string">' '</span>));
	runtime.emit_gcode(<span class="hljs-string">'M100.1('</span> + <span class="hljs-built_in">JSON</span>.stringify(cmd3) + <span class="hljs-string">')'</span>);
    runtime.emit_gcode(<span class="hljs-string">'G4 P0'</span>);
    }

exports.PX = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) </span>{
	<span class="hljs-keyword">this</span>.cmd_posx = <span class="hljs-literal">undefined</span>
    probe(<span class="hljs-keyword">this</span>, {
		inp : args[<span class="hljs-number">2</span>],
		feed : args[<span class="hljs-number">1</span>],
		dist : {
			X : args[<span class="hljs-number">0</span>]
		}
	});
};

exports.PY = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) </span>{
	<span class="hljs-keyword">this</span>.cmd_posy = <span class="hljs-literal">undefined</span>
	probe(<span class="hljs-keyword">this</span>, {
		inp : args[<span class="hljs-number">2</span>],
		feed : args[<span class="hljs-number">1</span>],
		dist : {
			Y : args[<span class="hljs-number">0</span>]
		}
	})
};

exports.PZ = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) </span>{
	<span class="hljs-keyword">this</span>.cmd_posz = <span class="hljs-literal">undefined</span>
	probe(<span class="hljs-keyword">this</span>, {
		inp : args[<span class="hljs-number">2</span>],
		feed : args[<span class="hljs-number">1</span>],
		dist : {
			Z : args[<span class="hljs-number">0</span>]
		}
	})
};

exports.PA = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) </span>{
	<span class="hljs-keyword">this</span>.cmd_posa = <span class="hljs-literal">undefined</span>
	probe(<span class="hljs-keyword">this</span>, {
		inp : args[<span class="hljs-number">2</span>],
		feed : args[<span class="hljs-number">1</span>],
		dist : {
			A : args[<span class="hljs-number">0</span>]
		}
	})
};


exports.PB = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) </span>{
	<span class="hljs-keyword">this</span>.cmd_posb = <span class="hljs-literal">undefined</span>
	probe(<span class="hljs-keyword">this</span>, {
		inp : args[<span class="hljs-number">2</span>],
		feed : args[<span class="hljs-number">1</span>],
		dist : {
			B : args[<span class="hljs-number">0</span>]
		}
	})
};


exports.PC = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) </span>{
	<span class="hljs-keyword">this</span>.cmd_pos
	probe(<span class="hljs-keyword">this</span>, {
		inp : args[<span class="hljs-number">2</span>],
		feed : args[<span class="hljs-number">1</span>],
		dist : {
			C : args[<span class="hljs-number">0</span>]
		}
	})
};


exports.P2 = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) </span>{
	<span class="hljs-keyword">this</span>.cmd_posx = <span class="hljs-literal">undefined</span>
	<span class="hljs-keyword">this</span>.cmd_posy = <span class="hljs-literal">undefined</span>
	probe(<span class="hljs-keyword">this</span>, {
		inp : args[<span class="hljs-number">3</span>],
		feed : args[<span class="hljs-number">2</span>],
		dist : {
			X : args[<span class="hljs-number">0</span>],
			Y : args[<span class="hljs-number">1</span>]
		}
	})
};</div></div></div></div></body></html>