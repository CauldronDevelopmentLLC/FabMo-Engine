<!DOCTYPE html><html lang="en"><head><title>runtime/passthrough/index</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../"><meta name="groc-document-path" content="runtime/passthrough/index"><meta name="groc-project-path" content="runtime/passthrough/index.js"><meta name="groc-github-url" content="https://github.com/FabMo/FabMo-Engine.git"><link rel="stylesheet" type="text/css" media="all" href="../../assets/style.css"><script type="text/javascript" src="../../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/FabMo/FabMo-Engine.git/blob/master/runtime/passthrough/index.js">runtime/passthrough/index.js</a></div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><p>runtime/passthrough/index.js</p>
<p>This module defines the PassthroughRuntime which is a short-lived
attempt to pass G2 commands directly through the machine model to G2, to allow for things
like chilipeppr, etc to speak with the motion controller directly.  It plays havoc with FabMo&#39;s 
internal sense of state, though, and thus has been deprecated.</p>
<p>TODO - remove this module</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> log = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../log'</span>).logger(<span class="hljs-string">'passthrough'</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">PassthroughRuntime</span>(<span class="hljs-params"></span>) </span>{
	<span class="hljs-keyword">this</span>.machine = <span class="hljs-literal">null</span>;
	<span class="hljs-keyword">this</span>.driver = <span class="hljs-literal">null</span>;
}

PassthroughRuntime.prototype.toString = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
	<span class="hljs-keyword">return</span> <span class="hljs-string">"[PassthroughRuntime]"</span>;
}

PassthroughRuntime.prototype.connect = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">machine</span>) </span>{
	<span class="hljs-keyword">this</span>.machine = machine;
	<span class="hljs-keyword">this</span>.driver = machine.driver;

	<span class="hljs-keyword">this</span>.raw_data_handler =<span class="hljs-keyword">this</span>._onDriverRawData.bind(<span class="hljs-keyword">this</span>);
	<span class="hljs-keyword">this</span>.state_change_handler =<span class="hljs-keyword">this</span>._onDriverStateChange.bind(<span class="hljs-keyword">this</span>);
	<span class="hljs-keyword">this</span>.status_handler =  <span class="hljs-keyword">this</span>._onDriverStatus.bind(<span class="hljs-keyword">this</span>);

	<span class="hljs-keyword">this</span>.driver.on(<span class="hljs-string">'raw_data'</span>, <span class="hljs-keyword">this</span>.raw_data_handler);
	<span class="hljs-keyword">this</span>.driver.on(<span class="hljs-string">'state'</span>, <span class="hljs-keyword">this</span>.state_change_handler);
	<span class="hljs-keyword">this</span>.driver.on(<span class="hljs-string">'status'</span>,<span class="hljs-keyword">this</span>.status_handler);

	<span class="hljs-keyword">this</span>.machine.setState(<span class="hljs-keyword">this</span>, <span class="hljs-string">"passthrough"</span>);
};

PassthroughRuntime.prototype.disconnect = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
	<span class="hljs-keyword">this</span>.driver.removeListener(<span class="hljs-string">'raw_data'</span>, <span class="hljs-keyword">this</span>.raw_data_handler);
	<span class="hljs-keyword">this</span>.driver.removeListener(<span class="hljs-string">'state'</span>, <span class="hljs-keyword">this</span>.state_change_handler);
	<span class="hljs-keyword">this</span>.driver.removeListener(<span class="hljs-string">'status'</span>,<span class="hljs-keyword">this</span>.status_handler);
	<span class="hljs-keyword">this</span>.machine.quit();
	<span class="hljs-keyword">this</span>.machine.setState(<span class="hljs-keyword">this</span>, <span class="hljs-string">"idle"</span>);
};


PassthroughRuntime.prototype._onDriverStateChange = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">states</span>) </span>{

};

PassthroughRuntime.prototype._onDriverStatus = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">status</span>) </span>{</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Update our copy of the system status</p></div></div><div class="code"><div class="wrapper">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span>.machine.status) {
		<span class="hljs-keyword">if</span>(key <span class="hljs-keyword">in</span> status) {
			<span class="hljs-keyword">this</span>.machine.status[key] = status[key];
		}
	}
};

PassthroughRuntime.prototype._onDriverRawData = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">raw_data</span>) </span>{
	<span class="hljs-keyword">this</span>.machine.emit(<span class="hljs-string">"raw_data"</span>,raw_data.toString());
};

PassthroughRuntime.prototype.sendRawData = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
	<span class="hljs-keyword">this</span>.driver.write(data);
};

exports.PassthroughRuntime = PassthroughRuntime;</div></div></div></div></body></html>