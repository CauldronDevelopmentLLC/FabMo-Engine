<!DOCTYPE html><html lang="en"><head><title>dashboard/apps/editor.fma/js/cm-addons/jump-to-line</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../../../../"><meta name="groc-document-path" content="dashboard/apps/editor.fma/js/cm-addons/jump-to-line"><meta name="groc-project-path" content="dashboard/apps/editor.fma/js/cm-addons/jump-to-line.js"><link rel="stylesheet" type="text/css" media="all" href="../../../../../assets/style.css"><script type="text/javascript" src="../../../../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">dashboard/apps/editor.fma/js/cm-addons/jump-to-line.js</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><p>CodeMirror, copyright (c) by Marijn Haverbeke and others
Distributed under an MIT license: <a href="http://codemirror.net/LICENSE">http://codemirror.net/LICENSE</a></p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Defines jumpToLine command. Uses dialog.js if present.</p></div></div><div class="code"><div class="wrapper">(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">mod</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> exports == <span class="hljs-string">"object"</span> &amp;&amp; <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">module</span> == <span class="hljs-string">"object"</span>) <span class="hljs-comment">// CommonJS</span>
    mod(<span class="hljs-built_in">require</span>(<span class="hljs-string">"../../lib/codemirror"</span>), <span class="hljs-built_in">require</span>(<span class="hljs-string">"../dialog/dialog"</span>));
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> define == <span class="hljs-string">"function"</span> &amp;&amp; define.amd) <span class="hljs-comment">// AMD</span>
    define([<span class="hljs-string">"../../lib/codemirror"</span>, <span class="hljs-string">"../dialog/dialog"</span>], mod);
  <span class="hljs-keyword">else</span> <span class="hljs-comment">// Plain browser env</span>
    mod(CodeMirror);
})(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">CodeMirror</span>) </span>{
<span class="hljs-pi">  "use strict"</span>;

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dialog</span>(<span class="hljs-params">cm, text, shortText, deflt, f</span>) </span>{
    <span class="hljs-keyword">if</span> (cm.openDialog) cm.openDialog(text, f, {value: deflt, selectValueOnOpen: <span class="hljs-literal">true</span>});
    <span class="hljs-keyword">else</span> f(prompt(shortText, deflt));
  }

  <span class="hljs-keyword">var</span> jumpDialog =
      <span class="hljs-string">'Jump to line: &lt;input type="text" style="width: 10em" class="CodeMirror-search-field"/&gt; &lt;span style="color: #888" class="CodeMirror-search-hint"&gt;(Use line:column or scroll% syntax)&lt;/span&gt;'</span>;

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">interpretLine</span>(<span class="hljs-params">cm, string</span>) </span>{
    <span class="hljs-keyword">var</span> num = <span class="hljs-built_in">Number</span>(string)
    <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^[-+]/</span>.test(string)) <span class="hljs-keyword">return</span> cm.getCursor().line + num
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> num - <span class="hljs-number">1</span>
  }

  CodeMirror.commands.jumpToLine = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cm</span>) </span>{
    <span class="hljs-keyword">var</span> cur = cm.getCursor();
    dialog(cm, jumpDialog, <span class="hljs-string">"Jump to line:"</span>, (cur.line + <span class="hljs-number">1</span>) + <span class="hljs-string">":"</span> + cur.ch, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">posStr</span>) </span>{
      <span class="hljs-keyword">if</span> (!posStr) <span class="hljs-keyword">return</span>;

      <span class="hljs-keyword">var</span> match;
      <span class="hljs-keyword">if</span> (match = <span class="hljs-regexp">/^\s*([\+\-]?\d+)\s*\:\s*(\d+)\s*$/</span>.exec(posStr)) {
        cm.setCursor(interpretLine(cm, match[<span class="hljs-number">1</span>]), <span class="hljs-built_in">Number</span>(match[<span class="hljs-number">2</span>]))
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (match = <span class="hljs-regexp">/^\s*([\+\-]?\d+(\.\d+)?)\%\s*/</span>.exec(posStr)) {
        <span class="hljs-keyword">var</span> line = <span class="hljs-built_in">Math</span>.round(cm.lineCount() * <span class="hljs-built_in">Number</span>(match[<span class="hljs-number">1</span>]) / <span class="hljs-number">100</span>);
        <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^[-+]/</span>.test(match[<span class="hljs-number">1</span>])) line = cur.line + line + <span class="hljs-number">1</span>;
        cm.setCursor(line - <span class="hljs-number">1</span>, cur.ch);
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (match = <span class="hljs-regexp">/^\s*\:?\s*([\+\-]?\d+)\s*/</span>.exec(posStr)) {
        cm.setCursor(interpretLine(cm, match[<span class="hljs-number">1</span>]), cur.ch);
      }
    });
  };

  CodeMirror.keyMap[<span class="hljs-string">"default"</span>][<span class="hljs-string">"Alt-G"</span>] = <span class="hljs-string">"jumpToLine"</span>;
});</div></div></div></div></body></html>