<!DOCTYPE html><html lang="en"><head><title>dashboard/apps/editor.fma/js/cm-addons/dialog</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../../../../"><meta name="groc-document-path" content="dashboard/apps/editor.fma/js/cm-addons/dialog"><meta name="groc-project-path" content="dashboard/apps/editor.fma/js/cm-addons/dialog.js"><link rel="stylesheet" type="text/css" media="all" href="../../../../../assets/style.css"><script type="text/javascript" src="../../../../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">dashboard/apps/editor.fma/js/cm-addons/dialog.js</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><p>CodeMirror, copyright (c) by Marijn Haverbeke and others
Distributed under an MIT license: <a href="http://codemirror.net/LICENSE">http://codemirror.net/LICENSE</a></p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Open simple dialogs on top of an editor. Relies on dialog.css.</p></div></div><div class="code"><div class="wrapper">(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">mod</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> exports == <span class="hljs-string">"object"</span> &amp;&amp; <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">module</span> == <span class="hljs-string">"object"</span>) <span class="hljs-comment">// CommonJS</span>
    mod(<span class="hljs-built_in">require</span>(<span class="hljs-string">"../../lib/codemirror"</span>));
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> define == <span class="hljs-string">"function"</span> &amp;&amp; define.amd) <span class="hljs-comment">// AMD</span>
    define([<span class="hljs-string">"../../lib/codemirror"</span>], mod);
  <span class="hljs-keyword">else</span> <span class="hljs-comment">// Plain browser env</span>
    mod(CodeMirror);
})(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">CodeMirror</span>) </span>{
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dialogDiv</span>(<span class="hljs-params">cm, template, bottom</span>) </span>{
    <span class="hljs-keyword">var</span> wrap = cm.getWrapperElement();
    <span class="hljs-keyword">var</span> dialog;
    dialog = wrap.appendChild(<span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">"div"</span>));
    <span class="hljs-keyword">if</span> (bottom)
      dialog.className = <span class="hljs-string">"CodeMirror-dialog CodeMirror-dialog-bottom"</span>;
    <span class="hljs-keyword">else</span>
      dialog.className = <span class="hljs-string">"CodeMirror-dialog CodeMirror-dialog-top"</span>;

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> template == <span class="hljs-string">"string"</span>) {
      dialog.innerHTML = template;
    } <span class="hljs-keyword">else</span> { <span class="hljs-comment">// Assuming it's a detached DOM element.</span>
      dialog.appendChild(template);
    }
    <span class="hljs-keyword">return</span> dialog;
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">closeNotification</span>(<span class="hljs-params">cm, newVal</span>) </span>{
    <span class="hljs-keyword">if</span> (cm.state.currentNotificationClose)
      cm.state.currentNotificationClose();
    cm.state.currentNotificationClose = newVal;
  }

  CodeMirror.defineExtension(<span class="hljs-string">"openDialog"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">template, callback, options</span>) </span>{
    <span class="hljs-keyword">if</span> (!options) options = {};

    closeNotification(<span class="hljs-keyword">this</span>, <span class="hljs-literal">null</span>);

    <span class="hljs-keyword">var</span> dialog = dialogDiv(<span class="hljs-keyword">this</span>, template, options.bottom);
    <span class="hljs-keyword">var</span> closed = <span class="hljs-literal">false</span>, me = <span class="hljs-keyword">this</span>;
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">close</span>(<span class="hljs-params">newVal</span>) </span>{
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> newVal == <span class="hljs-string">'string'</span>) {
        inp.value = newVal;
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">if</span> (closed) <span class="hljs-keyword">return</span>;
        closed = <span class="hljs-literal">true</span>;
        dialog.parentNode.removeChild(dialog);
        me.focus();

        <span class="hljs-keyword">if</span> (options.onClose) options.onClose(dialog);
      }
    }

    <span class="hljs-keyword">var</span> inp = dialog.getElementsByTagName(<span class="hljs-string">"input"</span>)[<span class="hljs-number">0</span>], button;
    <span class="hljs-keyword">if</span> (inp) {
      inp.focus();

      <span class="hljs-keyword">if</span> (options.value) {
        inp.value = options.value;
        <span class="hljs-keyword">if</span> (options.selectValueOnOpen !== <span class="hljs-literal">false</span>) {
          inp.select();
        }
      }

      <span class="hljs-keyword">if</span> (options.onInput)
        CodeMirror.on(inp, <span class="hljs-string">"input"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{ options.onInput(e, inp.value, close);});
      <span class="hljs-keyword">if</span> (options.onKeyUp)
        CodeMirror.on(inp, <span class="hljs-string">"keyup"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{options.onKeyUp(e, inp.value, close);});

      CodeMirror.on(inp, <span class="hljs-string">"keydown"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        <span class="hljs-keyword">if</span> (options &amp;&amp; options.onKeyDown &amp;&amp; options.onKeyDown(e, inp.value, close)) { <span class="hljs-keyword">return</span>; }
        <span class="hljs-keyword">if</span> (e.keyCode == <span class="hljs-number">27</span> || (options.closeOnEnter !== <span class="hljs-literal">false</span> &amp;&amp; e.keyCode == <span class="hljs-number">13</span>)) {
          inp.blur();
          CodeMirror.e_stop(e);
          close();
        }
        <span class="hljs-keyword">if</span> (e.keyCode == <span class="hljs-number">13</span>) callback(inp.value, e);
      });

      <span class="hljs-keyword">if</span> (options.closeOnBlur !== <span class="hljs-literal">false</span>) CodeMirror.on(inp, <span class="hljs-string">"blur"</span>, close);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (button = dialog.getElementsByTagName(<span class="hljs-string">"button"</span>)[<span class="hljs-number">0</span>]) {
      CodeMirror.on(button, <span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        close();
        me.focus();
      });

      <span class="hljs-keyword">if</span> (options.closeOnBlur !== <span class="hljs-literal">false</span>) CodeMirror.on(button, <span class="hljs-string">"blur"</span>, close);

      button.focus();
    }
    <span class="hljs-keyword">return</span> close;
  });

  CodeMirror.defineExtension(<span class="hljs-string">"openConfirm"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">template, callbacks, options</span>) </span>{
    closeNotification(<span class="hljs-keyword">this</span>, <span class="hljs-literal">null</span>);
    <span class="hljs-keyword">var</span> dialog = dialogDiv(<span class="hljs-keyword">this</span>, template, options &amp;&amp; options.bottom);
    <span class="hljs-keyword">var</span> buttons = dialog.getElementsByTagName(<span class="hljs-string">"button"</span>);
    <span class="hljs-keyword">var</span> closed = <span class="hljs-literal">false</span>, me = <span class="hljs-keyword">this</span>, blurring = <span class="hljs-number">1</span>;
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">close</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">if</span> (closed) <span class="hljs-keyword">return</span>;
      closed = <span class="hljs-literal">true</span>;
      dialog.parentNode.removeChild(dialog);
      me.focus();
    }
    buttons[<span class="hljs-number">0</span>].focus();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; buttons.length; ++i) {
      <span class="hljs-keyword">var</span> b = buttons[i];
      (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">callback</span>) </span>{
        CodeMirror.on(b, <span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
          CodeMirror.e_preventDefault(e);
          close();
          <span class="hljs-keyword">if</span> (callback) callback(me);
        });
      })(callbacks[i]);
      CodeMirror.on(b, <span class="hljs-string">"blur"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        --blurring;
        setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">if</span> (blurring &lt;= <span class="hljs-number">0</span>) close(); }, <span class="hljs-number">200</span>);
      });
      CodeMirror.on(b, <span class="hljs-string">"focus"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ ++blurring; });
    }
  });</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>openNotification
Opens a notification, that can be closed with an optional timer
(default 5000ms timer) and always closes on click.</p>
<p>If a notification is opened while another is opened, it will close the
currently opened one and open the new one immediately.</p></div></div><div class="code"><div class="wrapper">  CodeMirror.defineExtension(<span class="hljs-string">"openNotification"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">template, options</span>) </span>{
    closeNotification(<span class="hljs-keyword">this</span>, close);
    <span class="hljs-keyword">var</span> dialog = dialogDiv(<span class="hljs-keyword">this</span>, template, options &amp;&amp; options.bottom);
    <span class="hljs-keyword">var</span> closed = <span class="hljs-literal">false</span>, doneTimer;
    <span class="hljs-keyword">var</span> duration = options &amp;&amp; <span class="hljs-keyword">typeof</span> options.duration !== <span class="hljs-string">"undefined"</span> ? options.duration : <span class="hljs-number">5000</span>;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">close</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">if</span> (closed) <span class="hljs-keyword">return</span>;
      closed = <span class="hljs-literal">true</span>;
      clearTimeout(doneTimer);
      dialog.parentNode.removeChild(dialog);
    }

    CodeMirror.on(dialog, <span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
      CodeMirror.e_preventDefault(e);
      close();
    });

    <span class="hljs-keyword">if</span> (duration)
      doneTimer = setTimeout(close, duration);

    <span class="hljs-keyword">return</span> close;
  });
});</div></div></div></div></body></html>