<!DOCTYPE html><html lang="en"><head><title>dashboard/apps/editor.fma/js/simple</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../../../"><meta name="groc-document-path" content="dashboard/apps/editor.fma/js/simple"><meta name="groc-project-path" content="dashboard/apps/editor.fma/js/simple.js"><link rel="stylesheet" type="text/css" media="all" href="../../../../assets/style.css"><script type="text/javascript" src="../../../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">dashboard/apps/editor.fma/js/simple.js</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><p>CodeMirror, copyright (c) by Marijn Haverbeke and others
Distributed under an MIT license: <a href="http://codemirror.net/LICENSE">http://codemirror.net/LICENSE</a></p></div></div><div class="code"><div class="wrapper">(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">mod</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> exports == <span class="hljs-string">"object"</span> &amp;&amp; <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">module</span> == <span class="hljs-string">"object"</span>) <span class="hljs-comment">// CommonJS</span>
    mod(<span class="hljs-built_in">require</span>(<span class="hljs-string">"./codemirror.js"</span>));
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> define == <span class="hljs-string">"function"</span> &amp;&amp; define.amd) <span class="hljs-comment">// AMD</span>
    define([<span class="hljs-string">"./codemirror.js"</span>], mod);
  <span class="hljs-keyword">else</span> <span class="hljs-comment">// Plain browser env</span>
    mod(CodeMirror);
})(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">CodeMirror</span>) </span>{
<span class="hljs-pi">  "use strict"</span>;

  CodeMirror.defineSimpleMode = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, states</span>) </span>{
    CodeMirror.defineMode(name, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">config</span>) </span>{
      <span class="hljs-keyword">return</span> CodeMirror.simpleMode(config, states);
    });
  };

  CodeMirror.simpleMode = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">config, states</span>) </span>{
    ensureState(states, <span class="hljs-string">"start"</span>);
    <span class="hljs-keyword">var</span> states_ = {}, meta = states.meta || {}, hasIndentation = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> state <span class="hljs-keyword">in</span> states) <span class="hljs-keyword">if</span> (state != meta &amp;&amp; states.hasOwnProperty(state)) {
      <span class="hljs-keyword">var</span> list = states_[state] = [], orig = states[state];
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; orig.length; i++) {
        <span class="hljs-keyword">var</span> data = orig[i];
        list.push(<span class="hljs-keyword">new</span> Rule(data, states));
        <span class="hljs-keyword">if</span> (data.indent || data.dedent) hasIndentation = <span class="hljs-literal">true</span>;
      }
    }
    <span class="hljs-keyword">var</span> mode = {
      startState: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> {state: <span class="hljs-string">"start"</span>, pending: <span class="hljs-literal">null</span>,
                local: <span class="hljs-literal">null</span>, localState: <span class="hljs-literal">null</span>,
                indent: hasIndentation ? [] : <span class="hljs-literal">null</span>};
      },
      copyState: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state</span>) </span>{
        <span class="hljs-keyword">var</span> s = {state: state.state, pending: state.pending,
                 local: state.local, localState: <span class="hljs-literal">null</span>,
                 indent: state.indent &amp;&amp; state.indent.slice(<span class="hljs-number">0</span>)};
        <span class="hljs-keyword">if</span> (state.localState)
          s.localState = CodeMirror.copyState(state.local.mode, state.localState);
        <span class="hljs-keyword">if</span> (state.stack)
          s.stack = state.stack.slice(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> pers = state.persistentStates; pers; pers = pers.next)
          s.persistentStates = {mode: pers.mode,
                                spec: pers.spec,
                                state: pers.state == state.localState ? s.localState : CodeMirror.copyState(pers.mode, pers.state),
                                next: s.persistentStates};
        <span class="hljs-keyword">return</span> s;
      },
      token: tokenFunction(states_, config),
      innerMode: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state</span>) </span>{ <span class="hljs-keyword">return</span> state.local &amp;&amp; {mode: state.local.mode, state: state.localState}; },
      indent: indentFunction(states_, meta)
    };
    <span class="hljs-keyword">if</span> (meta) <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> prop <span class="hljs-keyword">in</span> meta) <span class="hljs-keyword">if</span> (meta.hasOwnProperty(prop))
      mode[prop] = meta[prop];
    <span class="hljs-keyword">return</span> mode;
  };

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ensureState</span>(<span class="hljs-params">states, name</span>) </span>{
    <span class="hljs-keyword">if</span> (!states.hasOwnProperty(name))
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Undefined state "</span> + name + <span class="hljs-string">" in simple mode"</span>);
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toRegex</span>(<span class="hljs-params">val, caret</span>) </span>{
    <span class="hljs-keyword">if</span> (!val) <span class="hljs-keyword">return</span> <span class="hljs-regexp">/(?:)/</span>;
    <span class="hljs-keyword">var</span> flags = <span class="hljs-string">""</span>;
    <span class="hljs-keyword">if</span> (val <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">RegExp</span>) {
      <span class="hljs-keyword">if</span> (val.ignoreCase) flags = <span class="hljs-string">"i"</span>;
      val = val.source;
    } <span class="hljs-keyword">else</span> {
      val = <span class="hljs-built_in">String</span>(val);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>((caret === <span class="hljs-literal">false</span> ? <span class="hljs-string">""</span> : <span class="hljs-string">"^"</span>) + <span class="hljs-string">"(?:"</span> + val + <span class="hljs-string">")"</span>, flags);
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">asToken</span>(<span class="hljs-params">val</span>) </span>{
    <span class="hljs-keyword">if</span> (!val) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> val == <span class="hljs-string">"string"</span>) <span class="hljs-keyword">return</span> val.replace(<span class="hljs-regexp">/\./g</span>, <span class="hljs-string">" "</span>);
    <span class="hljs-keyword">var</span> result = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; val.length; i++)
      result.push(val[i] &amp;&amp; val[i].replace(<span class="hljs-regexp">/\./g</span>, <span class="hljs-string">" "</span>));
    <span class="hljs-keyword">return</span> result;
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Rule</span>(<span class="hljs-params">data, states</span>) </span>{
    <span class="hljs-keyword">if</span> (data.next || data.push) ensureState(states, data.next || data.push);
    <span class="hljs-keyword">this</span>.regex = toRegex(data.regex);
    <span class="hljs-keyword">this</span>.token = asToken(data.token);
    <span class="hljs-keyword">this</span>.data = data;
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">tokenFunction</span>(<span class="hljs-params">states, config</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">stream, state</span>) </span>{
      <span class="hljs-keyword">if</span> (state.pending) {
        <span class="hljs-keyword">var</span> pend = state.pending.shift();
        <span class="hljs-keyword">if</span> (state.pending.length == <span class="hljs-number">0</span>) state.pending = <span class="hljs-literal">null</span>;
        stream.pos += pend.text.length;
        <span class="hljs-keyword">return</span> pend.token;
      }

      <span class="hljs-keyword">if</span> (state.local) {
        <span class="hljs-keyword">if</span> (state.local.end &amp;&amp; stream.match(state.local.end)) {
          <span class="hljs-keyword">var</span> tok = state.local.endToken || <span class="hljs-literal">null</span>;
          state.local = state.localState = <span class="hljs-literal">null</span>;
          <span class="hljs-keyword">return</span> tok;
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">var</span> tok = state.local.mode.token(stream, state.localState), m;
          <span class="hljs-keyword">if</span> (state.local.endScan &amp;&amp; (m = state.local.endScan.exec(stream.current())))
            stream.pos = stream.start + m.index;
          <span class="hljs-keyword">return</span> tok;
        }
      }

      <span class="hljs-keyword">var</span> curState = states[state.state];
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; curState.length; i++) {
        <span class="hljs-keyword">var</span> rule = curState[i];
        <span class="hljs-keyword">var</span> matches = (!rule.data.sol || stream.sol()) &amp;&amp; stream.match(rule.regex);
        <span class="hljs-keyword">if</span> (matches) {
          <span class="hljs-keyword">if</span> (rule.data.next) {
            state.state = rule.data.next;
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rule.data.push) {
            (state.stack || (state.stack = [])).push(state.state);
            state.state = rule.data.push;
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rule.data.pop &amp;&amp; state.stack &amp;&amp; state.stack.length) {
            state.state = state.stack.pop();
          }

          <span class="hljs-keyword">if</span> (rule.data.mode)
            enterLocalMode(config, state, rule.data.mode, rule.token);
          <span class="hljs-keyword">if</span> (rule.data.indent)
            state.indent.push(stream.indentation() + config.indentUnit);
          <span class="hljs-keyword">if</span> (rule.data.dedent)
            state.indent.pop();
          <span class="hljs-keyword">if</span> (matches.length &gt; <span class="hljs-number">2</span>) {
            state.pending = [];
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">2</span>; j &lt; matches.length; j++)
              <span class="hljs-keyword">if</span> (matches[j])
                state.pending.push({text: matches[j], token: rule.token[j - <span class="hljs-number">1</span>]});
            stream.backUp(matches[<span class="hljs-number">0</span>].length - (matches[<span class="hljs-number">1</span>] ? matches[<span class="hljs-number">1</span>].length : <span class="hljs-number">0</span>));
            <span class="hljs-keyword">return</span> rule.token[<span class="hljs-number">0</span>];
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rule.token &amp;&amp; rule.token.join) {
            <span class="hljs-keyword">return</span> rule.token[<span class="hljs-number">0</span>];
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> rule.token;
          }
        }
      }
      stream.next();
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    };
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cmp</span>(<span class="hljs-params">a, b</span>) </span>{
    <span class="hljs-keyword">if</span> (a === b) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (!a || <span class="hljs-keyword">typeof</span> a != <span class="hljs-string">"object"</span> || !b || <span class="hljs-keyword">typeof</span> b != <span class="hljs-string">"object"</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">var</span> props = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> prop <span class="hljs-keyword">in</span> a) <span class="hljs-keyword">if</span> (a.hasOwnProperty(prop)) {
      <span class="hljs-keyword">if</span> (!b.hasOwnProperty(prop) || !cmp(a[prop], b[prop])) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      props++;
    }
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> prop <span class="hljs-keyword">in</span> b) <span class="hljs-keyword">if</span> (b.hasOwnProperty(prop)) props--;
    <span class="hljs-keyword">return</span> props == <span class="hljs-number">0</span>;
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">enterLocalMode</span>(<span class="hljs-params">config, state, spec, token</span>) </span>{
    <span class="hljs-keyword">var</span> pers;
    <span class="hljs-keyword">if</span> (spec.persistent) <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> p = state.persistentStates; p &amp;&amp; !pers; p = p.next)
      <span class="hljs-keyword">if</span> (spec.spec ? cmp(spec.spec, p.spec) : spec.mode == p.mode) pers = p;
    <span class="hljs-keyword">var</span> mode = pers ? pers.mode : spec.mode || CodeMirror.getMode(config, spec.spec);
    <span class="hljs-keyword">var</span> lState = pers ? pers.state : CodeMirror.startState(mode);
    <span class="hljs-keyword">if</span> (spec.persistent &amp;&amp; !pers)
      state.persistentStates = {mode: mode, spec: spec.spec, state: lState, next: state.persistentStates};

    state.localState = lState;
    state.local = {mode: mode,
                   end: spec.end &amp;&amp; toRegex(spec.end),
                   endScan: spec.end &amp;&amp; spec.forceEnd !== <span class="hljs-literal">false</span> &amp;&amp; toRegex(spec.end, <span class="hljs-literal">false</span>),
                   endToken: token &amp;&amp; token.join ? token[token.length - <span class="hljs-number">1</span>] : token};
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">indexOf</span>(<span class="hljs-params">val, arr</span>) </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; arr.length; i++) <span class="hljs-keyword">if</span> (arr[i] === val) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">indentFunction</span>(<span class="hljs-params">states, meta</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state, textAfter, line</span>) </span>{
      <span class="hljs-keyword">if</span> (state.local &amp;&amp; state.local.mode.indent)
        <span class="hljs-keyword">return</span> state.local.mode.indent(state.localState, textAfter, line);
      <span class="hljs-keyword">if</span> (state.indent == <span class="hljs-literal">null</span> || state.local || meta.dontIndentStates &amp;&amp; indexOf(state.state, meta.dontIndentStates) &gt; -<span class="hljs-number">1</span>)
        <span class="hljs-keyword">return</span> CodeMirror.Pass;

      <span class="hljs-keyword">var</span> pos = state.indent.length - <span class="hljs-number">1</span>, rules = states[state.state];
      scan: <span class="hljs-keyword">for</span> (;;) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; rules.length; i++) {
          <span class="hljs-keyword">var</span> rule = rules[i];
          <span class="hljs-keyword">if</span> (rule.data.dedent &amp;&amp; rule.data.dedentIfLineStart !== <span class="hljs-literal">false</span>) {
            <span class="hljs-keyword">var</span> m = rule.regex.exec(textAfter);
            <span class="hljs-keyword">if</span> (m &amp;&amp; m[<span class="hljs-number">0</span>]) {
              pos--;
              <span class="hljs-keyword">if</span> (rule.next || rule.push) rules = states[rule.next || rule.push];
              textAfter = textAfter.slice(m[<span class="hljs-number">0</span>].length);
              <span class="hljs-keyword">continue</span> scan;
            }
          }
        }
        <span class="hljs-keyword">break</span>;
      }
      <span class="hljs-keyword">return</span> pos &lt; <span class="hljs-number">0</span> ? <span class="hljs-number">0</span> : state.indent[pos];
    };
  }
});</div></div></div></div></body></html>