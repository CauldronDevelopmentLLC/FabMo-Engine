<!doctype html>
<html>
<head>
  <title>G-Code Editor</title>
  <meta charset="utf-8"/>
  
  <link rel="stylesheet" href="css/foundation.min.css">
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="js/jquery.min.js"></script>
  <script src="js/foundation.min.js"></script>

</head>
<body style="background-color: #ffffff;">
  <header class="grey">
    <section>
      <div class="app-title-container">
        <h2 id="app-header">Configuration</h2>
      </div>
    </section>
  </header>

<div class="row">
  <form>

  <ul class="tabs" data-tab role="tablist">
    <li class="tab-title active" role="presentational" ><a href="#tabpanel1" role="tab" tabindex="0" aria-selected="true" controls="tabpanel1">General</a></li>
    <li class="tab-title" role="presentational" ><a href="#tabpanel2" role="tab" tabindex="0"aria-selected="false" controls="tabpanel2">Axis</a></li>
    <li class="tab-title" role="presentational" ><a href="#tabpanel3" role="tab" tabindex="0"aria-selected="false" controls="tabpanel3">Inputs</a></li>

    <li class="tab-title" role="presentational" ><a href="#tabpanel4" role="tab" tabindex="0"aria-selected="false" controls="tabpanel3">Channels</a></li>

  </ul>
<div class="tabs-content">
  <section role="tabpanel" aria-hidden="false" class="content active" id="tabpanel1">
    <div class="row">
      <fieldset>
        <legend>General Settings</legend>
        <div class="large-4 columns">
          <div class="row collapse">
            <label>Chordal Tolerance</label>
            <div class="small-9 columns">
              <input type="text" id="driver_ct" class="driver_input"/>
            </div>
            <div class="small-3 columns">
              <span class="postfix">mm</span>
            </div>
          </div>
        </div>
        <div class="large-4 columns">
          <div class="row collapse">
            <label>Junction Acceleration</label>
            <div class="small-9 columns">
              <input type="text" id="driver_ja" class="driver_input"/>
            </div>
            <div class="small-3 columns">
              <span class="postfix">mm/min<sup>2</sup></span>
            </div>
          </div>
        </div>
      </fieldset>
    </div>

    <div class="row">
      <fieldset>
        <legend>Logging</legend>
        <div class="large-4 columns">
          <div class="row collapse">
              <label>Function
                <select id="engine_log_level" class="engine_input">
                  <option value="g2">G2</option>
                  <option value="debug">Debug</option>
                  <option value="info">Informational</option>
                  <option value="warning">Warnings</option>
                  <option value="error">Error</option>
                </select>
              </label>
          </div>
        </div>
        <div class="large-4 columns">
          <div class="row collapse">
            <label>Status Report Interval</label>
            <div class="small-9 columns">
              <input type="text" id="driver_si" class="driver_input"/>
            </div>
            <div class="small-3 columns">
              <span class="postfix">ms</span>
            </div>
          </div>
        </div>
      </fieldset>
    </div>

  </section>
  <section role="tabpanel" aria-hidden="true" class="content" id="tabpanel2">
      <div class="row">
        <fieldset>
          <legend>X-Axis</legend>
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Feedrate Maximum</label>
              <div class="small-9 columns">
                <input type="text" id="driver_xfr" class="driver_input"/>
              </div>
              <div class="small-3 columns">
                <span class="postfix">in/min</span>
              </div>
            </div>
          </div>
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Velocity Maximum</label>
              <div class="small-9 columns">
                <input type="text" id="driver_xvm" class="driver_input" />
              </div>
              <div class="small-3 columns">
                <span class="postfix">in/min</span>
              </div>
            </div>
        </div>
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Maximum Jerk</label>
              <div class="small-9 columns">
                <input type="text" id="driver_xjm" class="driver_input" />
              </div>
              <div class="small-3 columns">
                <span class="postfix">jerk</span>
              </div>
            </div>
        </div>
        </fieldset>
        </div>

      <div class="row">
        <fieldset>
          <legend>Y-Axis</legend>
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Feedrate Maximum</label>
              <div class="small-9 columns">
                <input type="text" id="driver_yfr" class="driver_input"/>
              </div>
              <div class="small-3 columns">
                <span class="postfix">in/min</span>
              </div>
            </div>
          </div>
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Velocity Maximum</label>
              <div class="small-9 columns">
                <input type="text" id="driver_yvm" class="driver_input" />
              </div>
              <div class="small-3 columns">
                <span class="postfix">in/min</span>
              </div>
            </div>
        </div>
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Maximum Jerk</label>
              <div class="small-9 columns">
                <input type="text" id="driver_yjm" class="driver_input" />
              </div>
              <div class="small-3 columns">
                <span class="postfix">jerk</span>
              </div>
            </div>
        </div>
      </fieldset>
    </div>

      <div class="row">
        <fieldset>
          <legend>Z-Axis</legend>
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Feedrate Maximum</label>
              <div class="small-9 columns">
                <input type="text" id="driver_zfr" class="driver_input"/>
              </div>
              <div class="small-3 columns">
                <span class="postfix">in/min</span>
              </div>
            </div>
          </div>
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Velocity Maximum</label>
              <div class="small-9 columns">
                <input type="text" id="driver_zvm" class="driver_input" />
              </div>
              <div class="small-3 columns">
                <span class="postfix">in/min</span>
              </div>
            </div>
        </div>
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Maximum Jerk</label>
              <div class="small-9 columns">
                <input type="text" id="driver_zjm" class="driver_input" />
              </div>
              <div class="small-3 columns">
                <span class="postfix">jerk</span>
              </div>
            </div>
        </div>
        </fieldset>
        </div>
  </section>

<section role="tabpanel" aria-hidden="true" class="content" id="tabpanel3">
      <div class="row">
        <fieldset>
          <legend>Input 1</legend>
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Mode
                <select id="driver_di1mo" class="driver_input">
                  <option value="-1">Disabled</option>
                  <option value="0">Active Low</option>
                  <option value="1">Active High</option>
                </select>
              </label>
            </div>
          </div>  
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Action
                <select id="driver_di1ac" class="driver_input">
                  <option value="0">None</option>
                  <option value="1">Stop</option>
                  <option value="2">Fast Stop</option>
                  <option value="3">Halt</option>
                  <option value="4">Reset</option>
                </select>
              </label>
            </div>
          </div>   

          <div class="large-4 columns">
            <div class="row collapse">
              <label>Function
                <select id="driver_di1fn" class="driver_input">
                  <option value="0">None</option>
                  <option value="1">Limit</option>
                  <option value="2">Interlock</option>
                  <option value="3">Shutdown</option>
                </select>
              </label>
            </div>
          </div>             
        </fieldset>
        </div>

      <div class="row">
        <fieldset>
          <legend>Input 2</legend>
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Mode
                <select id="driver_di2mo" class="driver_input">
                  <option value="-1">Disabled</option>
                  <option value="0">Active Low</option>
                  <option value="1">Active High</option>
                </select>
              </label>
            </div>
          </div>  
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Action
                <select id="driver_di2ac" class="driver_input">
                  <option value="0">None</option>
                  <option value="1">Stop</option>
                  <option value="2">Fast Stop</option>
                  <option value="3">Halt</option>
                  <option value="4">Reset</option>
                </select>
              </label>
            </div>
          </div>   

          <div class="large-4 columns">
            <div class="row collapse">
              <label>Function
                <select id="driver_di2fn" class="driver_input">
                  <option value="0">None</option>
                  <option value="1">Limit</option>
                  <option value="2">Interlock</option>
                  <option value="3">Shutdown</option>
                </select>
              </label>
            </div>
          </div>             
        </fieldset>
        </div>
  
      <div class="row">
        <fieldset>
          <legend>Input 3</legend>
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Mode
                <select id="driver_di3mo" class="driver_input">
                  <option value="-1">Disabled</option>
                  <option value="0">Active Low</option>
                  <option value="1">Active High</option>
                </select>
              </label>
            </div>
          </div>  
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Action
                <select id="driver_di3ac" class="driver_input">
                  <option value="0">None</option>
                  <option value="1">Stop</option>
                  <option value="2">Fast Stop</option>
                  <option value="3">Halt</option>
                  <option value="4">Reset</option>
                </select>
              </label>
            </div>
          </div>   

          <div class="large-4 columns">
            <div class="row collapse">
              <label>Function
                <select id="driver_di3fn" class="driver_input">
                  <option value="0">None</option>
                  <option value="1">Limit</option>
                  <option value="2">Interlock</option>
                  <option value="3">Shutdown</option>
                </select>
              </label>
            </div>
          </div>             
        </fieldset>
        </div>

      <div class="row">
        <fieldset>
          <legend>Input 4</legend>
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Mode
                <select id="driver_di4mo" class="driver_input">
                  <option value="-1">Disabled</option>
                  <option value="0">Active Low</option>
                  <option value="1">Active High</option>
                </select>
              </label>
            </div>
          </div>  
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Action
                <select id="driver_di4ac" class="driver_input">
                  <option value="0">None</option>
                  <option value="1">Stop</option>
                  <option value="2">Fast Stop</option>
                  <option value="3">Halt</option>
                  <option value="4">Reset</option>
                </select>
              </label>
            </div>
          </div>   

          <div class="large-4 columns">
            <div class="row collapse">
              <label>Function
                <select id="driver_di4fn" class="driver_input">
                  <option value="0">None</option>
                  <option value="1">Limit</option>
                  <option value="2">Interlock</option>
                  <option value="3">Shutdown</option>
                </select>
              </label>
            </div>
          </div>             
        </fieldset>
        </div>

        <div class="row">
        <fieldset>
          <legend>Input 5</legend>
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Mode
                <select id="driver_di5mo" class="driver_input">
                  <option value="-1">Disabled</option>
                  <option value="0">Active Low</option>
                  <option value="1">Active High</option>
                </select>
              </label>
            </div>
          </div>  
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Action
                <select id="driver_di5ac" class="driver_input">
                  <option value="0">None</option>
                  <option value="1">Stop</option>
                  <option value="2">Fast Stop</option>
                  <option value="3">Halt</option>
                  <option value="4">Reset</option>
                </select>
              </label>
            </div>
          </div>   

          <div class="large-4 columns">
            <div class="row collapse">
              <label>Function
                <select id="driver_di45n" class="driver_input">
                  <option value="0">None</option>
                  <option value="1">Limit</option>
                  <option value="2">Interlock</option>
                  <option value="3">Shutdown</option>
                </select>
              </label>
            </div>
          </div>             
        </fieldset>
        </div>

         <div class="row">
        <fieldset>
          <legend>Input 6</legend>
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Mode
                <select id="driver_di6mo" class="driver_input">
                  <option value="-1">Disabled</option>
                  <option value="0">Active Low</option>
                  <option value="1">Active High</option>
                </select>
              </label>
            </div>
          </div>  
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Action
                <select id="driver_di6ac" class="driver_input">
                  <option value="0">None</option>
                  <option value="1">Stop</option>
                  <option value="2">Fast Stop</option>
                  <option value="3">Halt</option>
                  <option value="4">Reset</option>
                </select>
              </label>
            </div>
          </div>   

          <div class="large-4 columns">
            <div class="row collapse">
              <label>Function
                <select id="driver_di6fn" class="driver_input">
                  <option value="0">None</option>
                  <option value="1">Limit</option>
                  <option value="2">Interlock</option>
                  <option value="3">Shutdown</option>
                </select>
              </label>
            </div>
          </div>             
        </fieldset>
        </div>

         <div class="row">
        <fieldset>
          <legend>Input 7</legend>
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Mode
                <select id="driver_di7mo" class="driver_input">
                  <option value="-1">Disabled</option>
                  <option value="0">Active Low</option>
                  <option value="1">Active High</option>
                </select>
              </label>
            </div>
          </div>  
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Action
                <select id="driver_di7ac" class="driver_input">
                  <option value="0">None</option>
                  <option value="1">Stop</option>
                  <option value="2">Fast Stop</option>
                  <option value="3">Halt</option>
                  <option value="4">Reset</option>
                </select>
              </label>
            </div>
          </div>   

          <div class="large-4 columns">
            <div class="row collapse">
              <label>Function
                <select id="driver_di7fn" class="driver_input">
                  <option value="0">None</option>
                  <option value="1">Limit</option>
                  <option value="2">Interlock</option>
                  <option value="3">Shutdown</option>
                </select>
              </label>
            </div>
          </div>             
        </fieldset>
        </div>

         <div class="row">
        <fieldset>
          <legend>Input 8</legend>
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Mode
                <select id="driver_di8mo" class="driver_input">
                  <option value="-1">Disabled</option>
                  <option value="0">Active Low</option>
                  <option value="1">Active High</option>
                </select>
              </label>
            </div>
          </div>  
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Action
                <select id="driver_di8ac" class="driver_input">
                  <option value="0">None</option>
                  <option value="1">Stop</option>
                  <option value="2">Fast Stop</option>
                  <option value="3">Halt</option>
                  <option value="4">Reset</option>
                </select>
              </label>
            </div>
          </div>   

          <div class="large-4 columns">
            <div class="row collapse">
              <label>Function
                <select id="driver_di8fn" class="driver_input">
                  <option value="0">None</option>
                  <option value="1">Limit</option>
                  <option value="2">Interlock</option>
                  <option value="3">Shutdown</option>
                </select>
              </label>
            </div>
          </div>             
        </fieldset>
        </div>
  </section>

  <section role="tabpanel" aria-hidden="true" class="content" id="tabpanel4">
      <div class="row">
        <fieldset>
          <legend>Channel 1</legend>
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Travel/Revolution</label>
              <div class="small-9 columns">
                <input type="text" id="driver_1tr" class="driver_input"/>
              </div>
              <div class="small-3 columns">
                <span class="postfix">in/rev</span>
              </div>
            </div>
          </div>
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Microstep Resolution</label>
              <div class="small-9 columns">
                <input type="text" id="driver_1mi" class="driver_input" />
              </div>
              <div class="small-3 columns">
                <span class="postfix">microsteps</span>
              </div>
            </div>
        </div>
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Step Angle</label>
              <div class="small-9 columns">
                <input type="text" id="driver_1sa" class="driver_input" />
              </div>
              <div class="small-3 columns">
                <span class="postfix">degrees</span>
              </div>
            </div>
        </div>

          <div class="large-4 columns">
            <div class="row collapse">
              <label>Power Management Mode
                <select id="driver_1pm" class="driver_input">
                  <option value="0">Disabled</option>
                  <option value="1">Always on</option>
                  <option value="2">On only when in cycle</option>
                  <option value="3">On only when moving</option>
                </select>
              </label>
            </div>
        </div>
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Power Level</label>
              <div class="small-9 columns">
                <input type="text" id="driver_1pl" class="driver_input" />
              </div>
              <div class="small-3 columns">
                <span class="postfix">(0-1.0)</span>
              </div>
            </div>
        </div>

        </fieldset>
      </div>
  
      <div class="row">
        <fieldset>
          <legend>Channel 2</legend>
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Travel/Revolution</label>
              <div class="small-9 columns">
                <input type="text" id="driver_2tr" class="driver_input"/>
              </div>
              <div class="small-3 columns">
                <span class="postfix">in/rev</span>
              </div>
            </div>
          </div>
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Microstep Resolution</label>
              <div class="small-9 columns">
                <input type="text" id="driver_2mi" class="driver_input" />
              </div>
              <div class="small-3 columns">
                <span class="postfix">microsteps</span>
              </div>
            </div>
        </div>
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Step Angle</label>
              <div class="small-9 columns">
                <input type="text" id="driver_2sa" class="driver_input" />
              </div>
              <div class="small-3 columns">
                <span class="postfix">degrees</span>
              </div>
            </div>
          </div>
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Power Management Mode
                <select id="driver_2pm" class="driver_input">
                  <option value="0">Disabled</option>
                  <option value="1">Always on</option>
                  <option value="2">On only when in cycle</option>
                  <option value="3">On only when moving</option>
                </select>
              </label>
            </div>
        </div>
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Power Level</label>
              <div class="small-9 columns">
                <input type="text" id="driver_2pl" class="driver_input" />
              </div>
              <div class="small-3 columns">
                <span class="postfix">(0-1.0)</span>
              </div>
            </div>
        </div>

        </fieldset>
      </div>

      <div class="row">
        <fieldset>
          <legend>Channel 3</legend>
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Travel/Revolution</label>
              <div class="small-9 columns">
                <input type="text" id="driver_3tr" class="driver_input"/>
              </div>
              <div class="small-3 columns">
                <span class="postfix">in/rev</span>
              </div>
            </div>
          </div>
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Microstep Resolution</label>
              <div class="small-9 columns">
                <input type="text" id="driver_3mi" class="driver_input" />
              </div>
              <div class="small-3 columns">
                <span class="postfix">microsteps</span>
              </div>
            </div>
        </div>
          <div class="large-4 columns">
            <div class="row collapse">
              <label>Step Angle</label>
              <div class="small-9 columns">
                <input type="text" id="driver_3sa" class="driver_input" />
              </div>
              <div class="small-3 columns">
                <span class="postfix">degrees</span>
              </div>
            </div>
        </div>

          <div class="large-4 columns">
            <div class="row collapse">
              <label>Power Management Mode
                <select id="driver_3pm" class="driver_input">
                  <option value="0">Disabled</option>
                  <option value="1">Always on</option>
                  <option value="2">On only when in cycle</option>
                  <option value="3">On only when moving</option>
                </select>
              </label>
            </div>
        </div>

          <div class="large-4 columns">
            <div class="row collapse">
              <label>Power Level</label>
              <div class="small-9 columns">
                <input type="text" id="driver_3pl" class="driver_input" />
              </div>
              <div class="small-3 columns">
                <span class="postfix">(0-1.0)</span>
              </div>
            </div>
        </div>


        </fieldset>
      </div>

  </section>

</div>




  </form>
</div>
  <script src="/js/libs/dashboard.js"></script>
  <script>
    function update() {
        fabmoDashboard.getConfig(function(err, data) {
          if(err) {
            console.error(err);
          } else {
            for(key in data.driver) {
              value = data.driver[key];
              input = $('#driver_' + key);
              if(input.length) {
                input.val(value);
              }
            }
            for(key in data.engine) {
              value = data.engine[key];
              input = $('#engine_' + key);
              if(input.length) {
                input.val(value);
              }
            }

          }
        });
    }

    $(document).ready(function() {
      $(document).foundation();
      update();

      $('.driver_input').change( function() {
        var parts = this.id.split("_");
        var type = parts[0];
        var key = parts[1];
        // Workaround for (restify bug?)
        if(key[0].match(/[0-9]/)) {
          key = '_' + key;
        }
        var o = {}
        o[key] = this.value
        cfg = {}
        cfg[type] = o
        fabmoDashboard.setConfig(cfg, function(err, data) {
          update();
        });
      });

      $('.engine_input').change( function() {
        var parts = this.id.split("_");
        var type = parts[0];
        var key = parts[1];
        var o = {}
        o[key] = this.value
        cfg = {}
        cfg[type] = o
        fabmoDashboard.setConfig(cfg, function(err, data) {
          update();
        });
      });

    });
  </script>

</body>
</html>
