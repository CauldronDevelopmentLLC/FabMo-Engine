<!DOCTYPE html><html lang="en"><head><title>dashboard/apps/configuration.fma/js/configuration</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../../../"><meta name="groc-document-path" content="dashboard/apps/configuration.fma/js/configuration"><meta name="groc-project-path" content="dashboard/apps/configuration.fma/js/configuration.js"><link rel="stylesheet" type="text/css" media="all" href="../../../../assets/style.css"><script type="text/javascript" src="../../../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">dashboard/apps/configuration.fma/js/configuration.js</div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-built_in">require</span>(<span class="hljs-string">'./jquery.dragster.js'</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'jquery'</span>);
<span class="hljs-keyword">var</span> setApps = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./app_manager.js'</span>);
<span class="hljs-keyword">var</span> setUsers = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./user_manager'</span>);
<span class="hljs-keyword">var</span> Foundation = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../../static/js/libs/foundation.min.js'</span>);
<span class="hljs-keyword">var</span> moment = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../../static/js/libs/moment.js'</span>);
<span class="hljs-keyword">var</span> Fabmo = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../../static/js/libs/fabmo.js'</span>);
<span class="hljs-keyword">var</span> fabmo = <span class="hljs-keyword">new</span> Fabmo;

$(<span class="hljs-string">'body'</span>).bind(<span class="hljs-string">'focusin focus'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>{
  e.preventDefault();
})
<span class="hljs-keyword">var</span> unit_label_index = {}

<span class="hljs-keyword">var</span> registerUnitLabel = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">label, in_label, mm_label</span>) </span>{
  <span class="hljs-keyword">var</span> labels = {
    <span class="hljs-string">'in'</span> : in_label,
    <span class="hljs-string">'mm'</span> : mm_label
  }
  unit_label_index[label] = labels;
}

<span class="hljs-keyword">var</span> updateLabels = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">unit</span>) </span>{
	$.each(unit_label_index, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key, value</span>) </span>{
		$(key).html(value[unit]);
	});
}

<span class="hljs-keyword">var</span> flattenObject = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ob</span>) </span>{
  <span class="hljs-keyword">var</span> toReturn = {};
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> ob) {
    <span class="hljs-keyword">if</span> (!ob.hasOwnProperty(i)) <span class="hljs-keyword">continue</span>;

    <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">typeof</span> ob[i]) == <span class="hljs-string">'object'</span>) {
      <span class="hljs-keyword">var</span> flatObject = flattenObject(ob[i]);
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x <span class="hljs-keyword">in</span> flatObject) {
        <span class="hljs-keyword">if</span> (!flatObject.hasOwnProperty(x)) <span class="hljs-keyword">continue</span>;

        toReturn[i + <span class="hljs-string">'-'</span> + x] = flatObject[x];
      }
    } <span class="hljs-keyword">else</span> {
      toReturn[i] = ob[i];
    }
  }
  <span class="hljs-keyword">return</span> toReturn;
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span>(<span class="hljs-params"></span>) </span>{
  fabmo.getVersion(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, version</span>) </span>{
    <span class="hljs-keyword">switch</span>(version.type) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">'dev'</span>:
        $(<span class="hljs-string">'.engine-version'</span>).text(version.hash.substring(<span class="hljs-number">0</span>,<span class="hljs-number">12</span>) + <span class="hljs-string">'-dev'</span>);
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'release'</span>:
        $(<span class="hljs-string">'.engine-version'</span>).text(version.number);
        <span class="hljs-keyword">break</span>;
    }
  });
    fabmo.getConfig(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) </span>{
      <span class="hljs-keyword">if</span>(err) {
        <span class="hljs-built_in">console</span>.error(err);
      } <span class="hljs-keyword">else</span> {
        configData = data;
        [<span class="hljs-string">'driver'</span>, <span class="hljs-string">'engine'</span>, <span class="hljs-string">'opensbp'</span>, <span class="hljs-string">'machine'</span>].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">branchname</span>) </span>{
            branch = flattenObject(data[branchname]);
            <span class="hljs-keyword">for</span>(key <span class="hljs-keyword">in</span> branch) {
              v = branch[key];
              input = $(<span class="hljs-string">'#'</span> + branchname + <span class="hljs-string">'-'</span> + key);
              <span class="hljs-keyword">if</span>(input.length) {
                  <span class="hljs-keyword">if</span> (input.is(<span class="hljs-string">':checkbox'</span>)){
                    <span class="hljs-keyword">if</span> (v){
                        input.prop( <span class="hljs-string">"checked"</span>, <span class="hljs-literal">true</span> );
                    } <span class="hljs-keyword">else</span> {
                        input.prop( <span class="hljs-string">"checked"</span>, <span class="hljs-literal">false</span> );
                    }
                  } <span class="hljs-keyword">else</span> {
                    input.val(<span class="hljs-built_in">String</span>(v));
                  }
              }
            }
        });

        <span class="hljs-keyword">var</span> profiles = data[<span class="hljs-string">'profiles'</span>] || {}
        <span class="hljs-keyword">var</span> profilesList = $(<span class="hljs-string">'#profile-listbox'</span>);
        profilesList.empty();
        <span class="hljs-comment">//profilesList.empty();</span>
        <span class="hljs-keyword">if</span>(profiles) {
          <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> name <span class="hljs-keyword">in</span> profiles) {
            profilesList.append(
                $(<span class="hljs-string">'&lt;option&gt;&lt;/option&gt;'</span>).val(name).html(name)
            );
          }
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-built_in">console</span>.error(<span class="hljs-string">"No profiles!"</span>)
        }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Shim</p></div></div><div class="code"><div class="wrapper">        <span class="hljs-keyword">if</span>(data.engine.profile === <span class="hljs-string">'default'</span>) {
          data.engine.profile = <span class="hljs-string">'Default'</span>;
        }
        profilesList.val(data.engine.profile);
      }
    });

    fabmo.getNetworkIdentity(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) </span>{
      <span class="hljs-keyword">if</span> (err) {
        <span class="hljs-built_in">console</span>.info(<span class="hljs-string">'Network not reachable'</span>);
        <span class="hljs-keyword">return</span>
      }
      <span class="hljs-keyword">if</span>(data.id) {
        $(<span class="hljs-string">'#input-machine-name'</span>).val(data.name);
        $(<span class="hljs-string">'#section-machine-name'</span>).show();
      } <span class="hljs-keyword">else</span> {
        $(<span class="hljs-string">'#section-machine-name'</span>).hide();
      }

      <span class="hljs-keyword">if</span>(data.id) {
        $(<span class="hljs-string">'#input-machine-id'</span>).val(data.id);
        $(<span class="hljs-string">'#section-machine-id'</span>).show();
      } <span class="hljs-keyword">else</span> {
        $(<span class="hljs-string">'#section-machine-id'</span>).hide();
      }
    });

    fabmo.getUpdaterStatus(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, status</span>) </span>{
      <span class="hljs-keyword">if</span>(err) { <span class="hljs-keyword">return</span>; }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><pre><code>   fabmo.isOnline(function(err, online) {
      if(online) {
        $(&#39;#btn-update&#39;).removeClass(&#39;disabled&#39;);
        $(&#39;#btn-update&#39;).text(&#39;Update Software&#39;);
      } else {
        $(&#39;#btn-update&#39;).addClass(&#39;disabled&#39;);
        $(&#39;#btn-update&#39;).text(&#39;No Updates Available&#39;);
      }
    });</code></pre></div></div><div class="code"><div class="wrapper">      <span class="hljs-keyword">if</span>(status.updates) {
        $(<span class="hljs-string">'#btn-update'</span>).removeClass(<span class="hljs-string">'disabled'</span>).addClass(<span class="hljs-string">'update-available'</span>);
        $(<span class="hljs-string">'#btn-update'</span>).text(<span class="hljs-string">'Update Software'</span>);
        <span class="hljs-built_in">console</span>.info(status.updates);
      } <span class="hljs-keyword">else</span> {
        $(<span class="hljs-string">'#btn-update'</span>).addClass(<span class="hljs-string">'disabled'</span>).removeClass(<span class="hljs-string">'update-available'</span>);
        $(<span class="hljs-string">'#btn-update'</span>).text(<span class="hljs-string">'No Updates Available'</span>);
      }
    });
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setConfig</span>(<span class="hljs-params">id, value</span>) </span>{
	<span class="hljs-keyword">var</span> parts = id.split(<span class="hljs-string">"-"</span>);
	<span class="hljs-keyword">var</span> o = {};
	<span class="hljs-keyword">var</span> co = o;
	<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>;

	<span class="hljs-keyword">do</span> {
	  co[parts[i]] = {};
	  <span class="hljs-keyword">if</span>(i &lt; parts.length-<span class="hljs-number">1</span>) {
	    co = co[parts[i]];
	  }
	} <span class="hljs-keyword">while</span>(i++ <span class="xml"><span class="hljs-tag">&lt; <span class="hljs-attribute">parts.length-1</span> );
	<span class="hljs-attribute">co</span>[<span class="hljs-attribute">parts</span>[<span class="hljs-attribute">parts.length-1</span>]] = <span class="hljs-attribute">value</span>;
	<span class="hljs-attribute">fabmo.setConfig</span>(<span class="hljs-attribute">o</span>, <span class="hljs-attribute">function</span>(<span class="hljs-attribute">err</span>, <span class="hljs-attribute">data</span>) {
    <span class="hljs-attribute">notifyChange</span>(<span class="hljs-attribute">err</span>,<span class="hljs-attribute">id</span>);
    <span class="hljs-attribute">update</span>();
	});
}

<span class="hljs-attribute">var</span> <span class="hljs-attribute">notifyChange</span> = <span class="hljs-attribute">function</span>(<span class="hljs-attribute">err</span>,<span class="hljs-attribute">id</span>){
  <span class="hljs-attribute">if</span>(<span class="hljs-attribute">err</span>){
    $('#'+<span class="hljs-attribute">id</span>)<span class="hljs-attribute">.addClass</span>("<span class="hljs-attribute">flash-red</span>");
  }<span class="hljs-attribute">else</span>{
    $('#'+<span class="hljs-attribute">id</span>)<span class="hljs-attribute">.addClass</span>("<span class="hljs-attribute">flash-green</span>");
  }
  <span class="hljs-attribute">setTimeout</span>(<span class="hljs-attribute">function</span>(){$('#'+<span class="hljs-attribute">id</span>)<span class="hljs-attribute">.removeClass</span>("<span class="hljs-attribute">flash-red</span> <span class="hljs-attribute">flash-green</span>")},<span class="hljs-attribute">500</span>);
};

<span class="hljs-attribute">var</span> <span class="hljs-attribute">configData</span> = <span class="hljs-attribute">null</span>;
$('#<span class="hljs-attribute">btn-update</span>')<span class="hljs-attribute">.click</span>(<span class="hljs-attribute">function</span>(<span class="hljs-attribute">evt</span>) {
    <span class="hljs-attribute">if</span>(!$(<span class="hljs-attribute">this</span>)<span class="hljs-attribute">.hasClass</span>('<span class="hljs-attribute">disabled</span>')) {
        <span class="hljs-attribute">evt.preventDefault</span>();
        <span class="hljs-attribute">var</span> <span class="hljs-attribute">location</span> = <span class="hljs-attribute">window.location</span>;
        <span class="hljs-attribute">var</span> <span class="hljs-attribute">protocol</span> = <span class="hljs-attribute">location.protocol</span>;
        <span class="hljs-attribute">var</span> <span class="hljs-attribute">slashes</span> = <span class="hljs-attribute">protocol.concat</span>("//");
        <span class="hljs-attribute">var</span> <span class="hljs-attribute">host</span> = <span class="hljs-attribute">slashes.concat</span>(<span class="hljs-attribute">window.location.hostname</span>);
        <span class="hljs-attribute">var</span> <span class="hljs-attribute">port</span> = '<span class="hljs-attribute">:</span>' + (<span class="hljs-attribute">parseInt</span>((<span class="hljs-attribute">location.port</span> || <span class="hljs-attribute">80</span>)) + <span class="hljs-attribute">1</span>);
        <span class="hljs-attribute">var</span> <span class="hljs-attribute">url</span> = <span class="hljs-attribute">host.concat</span>(<span class="hljs-attribute">port</span>)<span class="hljs-attribute">.concat</span>('/<span class="hljs-attribute">do_update</span>')
        <span class="hljs-attribute">fabmo.navigate</span>(<span class="hljs-attribute">url</span>, {});
    }
});


$('#<span class="hljs-attribute">btn-backup</span>')<span class="hljs-attribute">.click</span>(<span class="hljs-attribute">function</span>(<span class="hljs-attribute">evt</span>) {
    <span class="hljs-attribute">fabmo.getConfig</span>(<span class="hljs-attribute">function</span>(<span class="hljs-attribute">err</span>,<span class="hljs-attribute">conf</span>){
        <span class="hljs-attribute">if</span>(<span class="hljs-attribute">err</span>){
            <span class="hljs-attribute">fabmo.notify</span>('<span class="hljs-attribute">error</span>','<span class="hljs-attribute">cannot</span> <span class="hljs-attribute">backup</span> <span class="hljs-attribute">the</span> <span class="hljs-attribute">config</span> !');
        }<span class="hljs-attribute">else</span>{
            <span class="hljs-attribute">fabmo._download</span>(<span class="hljs-attribute">JSON.stringify</span>(<span class="hljs-attribute">conf</span>), '<span class="hljs-attribute">fabmo_config_backup.fmc</span>','<span class="hljs-attribute">text</span>/<span class="hljs-attribute">json</span>');
        }
    });
});



$('#<span class="hljs-attribute">btn-restore</span>')<span class="hljs-attribute">.click</span>(<span class="hljs-attribute">function</span>(<span class="hljs-attribute">evt</span>) {
    $('#<span class="hljs-attribute">restore_conf_file</span>')<span class="hljs-attribute">.trigger</span>('<span class="hljs-attribute">click</span>');
});


$("#<span class="hljs-attribute">restore_conf_file</span>")<span class="hljs-attribute">.change</span>(<span class="hljs-attribute">function</span>() {
        <span class="hljs-attribute">var</span> <span class="hljs-attribute">files</span> = $(<span class="hljs-attribute">this</span>)<span class="hljs-attribute">.prop</span>('<span class="hljs-attribute">files</span>');
        <span class="hljs-attribute">if</span>(<span class="hljs-attribute">files.length</span>=<span class="hljs-value">==1){</span>
            <span class="hljs-attribute">var</span> <span class="hljs-attribute">conf_file</span> = <span class="hljs-attribute">files</span>[<span class="hljs-attribute">0</span>];
            <span class="hljs-attribute">if</span>(!<span class="hljs-attribute">conf_file</span>)<span class="hljs-attribute">return</span>;
            <span class="hljs-attribute">if</span>(<span class="hljs-attribute">conf_file.name.split</span>('<span class="hljs-attribute">.</span>')<span class="hljs-attribute">.pop</span>()!=<span class="hljs-value">='fmc'){</span>
                <span class="hljs-attribute">fabmo.notify</span>('<span class="hljs-attribute">error</span>','<span class="hljs-attribute">the</span> <span class="hljs-attribute">file</span> <span class="hljs-attribute">you</span> <span class="hljs-attribute">submit</span> <span class="hljs-attribute">is</span> <span class="hljs-attribute">not</span> <span class="hljs-attribute">valid</span>');
                $("#<span class="hljs-attribute">restore_conf_file</span>")<span class="hljs-attribute">.attr</span>("<span class="hljs-attribute">value</span>", "");
                <span class="hljs-attribute">return</span>;
            }

           <span class="hljs-attribute">var</span> <span class="hljs-attribute">reader</span> = <span class="hljs-attribute">new</span> <span class="hljs-attribute">FileReader</span>();
           <span class="hljs-attribute">reader.readAsText</span>(<span class="hljs-attribute">conf_file</span>);
           <span class="hljs-attribute">reader.onload</span> = <span class="hljs-attribute">function</span>(<span class="hljs-attribute">evt</span>)
           {
               <span class="hljs-attribute">try</span>{
                   <span class="hljs-attribute">conf</span> = <span class="hljs-attribute">JSON.parse</span>(<span class="hljs-attribute">evt.target.result</span>);
               }<span class="hljs-attribute">catch</span>(<span class="hljs-attribute">ex</span>){
                <span class="hljs-attribute">fabmo.notify</span>("<span class="hljs-attribute">error</span>","<span class="hljs-attribute">Error</span> <span class="hljs-attribute">reading</span> <span class="hljs-attribute">file</span> <span class="hljs-attribute">:</span> "+<span class="hljs-attribute">ex</span>);
                $("#<span class="hljs-attribute">restore_conf_file</span>")<span class="hljs-attribute">.attr</span>("<span class="hljs-attribute">value</span>", "");
                <span class="hljs-attribute">return</span>;
               }
               <span class="hljs-attribute">fabmo.setConfig</span>(<span class="hljs-attribute">conf</span>,<span class="hljs-attribute">function</span>(<span class="hljs-attribute">err</span>){
                   <span class="hljs-attribute">if</span>(<span class="hljs-attribute">err</span>){
                       <span class="hljs-attribute">fabmo.notify</span>("<span class="hljs-attribute">error</span>",<span class="hljs-attribute">err</span>);
                       $("#<span class="hljs-attribute">restore_conf_file</span>")<span class="hljs-attribute">.attr</span>("<span class="hljs-attribute">value</span>", "");
                       <span class="hljs-attribute">return</span>;
                   }
                   <span class="hljs-attribute">fabmo.notify</span>("<span class="hljs-attribute">success</span>","<span class="hljs-attribute">the</span> <span class="hljs-attribute">configuration</span> <span class="hljs-attribute">file</span> <span class="hljs-attribute">have</span> <span class="hljs-attribute">been</span> <span class="hljs-attribute">successfully</span> <span class="hljs-attribute">loaded</span> !");
                   $("#<span class="hljs-attribute">restore_conf_file</span>")<span class="hljs-attribute">.attr</span>("<span class="hljs-attribute">value</span>", "");
               });
           }
           <span class="hljs-attribute">reader.onerror</span> = <span class="hljs-attribute">function</span> (<span class="hljs-attribute">evt</span>) {
               <span class="hljs-attribute">fabmo.notify</span>("<span class="hljs-attribute">error</span>","<span class="hljs-attribute">Error</span> <span class="hljs-attribute">reading</span> <span class="hljs-attribute">file</span>");
               $("#<span class="hljs-attribute">restore_conf_file</span>")<span class="hljs-attribute">.attr</span>("<span class="hljs-attribute">value</span>", "");
           }

        }

    });

$(<span class="hljs-attribute">document</span>)<span class="hljs-attribute">.ready</span>(<span class="hljs-attribute">function</span>() {

    $(<span class="hljs-attribute">document</span>)<span class="hljs-attribute">.foundation</span>();
</span></span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Setup Unit Labels</p></div></div><div class="code"><div class="wrapper">    registerUnitLabel(<span class="hljs-string">'.in_mm_label'</span>, <span class="hljs-string">'in'</span>, <span class="hljs-string">'mm'</span>);
    registerUnitLabel(<span class="hljs-string">'.ipm_mmpm_label'</span>, <span class="hljs-string">'in/min'</span>, <span class="hljs-string">'mm/min'</span>);
    registerUnitLabel(<span class="hljs-string">'.ips_mmps_label'</span>, <span class="hljs-string">'in/sec'</span>, <span class="hljs-string">'mm/sec'</span>);
    registerUnitLabel(<span class="hljs-string">'.inpm2_mmpm2_label'</span>, <span class="hljs-string">'in/min&lt;sup&gt;2&lt;/sup&gt;'</span>, <span class="hljs-string">'mm/min&lt;sup&gt;2&lt;/sup&gt;'</span>);
    registerUnitLabel(<span class="hljs-string">'.inrev_mmrev_label'</span>, <span class="hljs-string">'in/rev'</span>, <span class="hljs-string">'mm/rev'</span>);
    registerUnitLabel(<span class="hljs-string">'.inpm3_mmpm3_label'</span>, <span class="hljs-string">'in/min&lt;sup&gt;3&lt;/sup&gt;'</span>, <span class="hljs-string">'mm/min&lt;sup&gt;3&lt;/sup&gt;'</span>);

    fabmo.on(<span class="hljs-string">'status'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">status</span>) </span>{
        updateLabels(status.unit);
    });
    fabmo.requestStatus();</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Populate Settings</p></div></div><div class="code"><div class="wrapper">    update();

    <span class="hljs-comment">///tool tip logic</span>

$(<span class="hljs-string">'.tool-tip'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
     <span class="hljs-keyword">var</span> tip =$(<span class="hljs-keyword">this</span>).parent().data(<span class="hljs-string">'tip'</span>);
     <span class="hljs-keyword">var</span> eTop = $(<span class="hljs-keyword">this</span>).offset().top;
     <span class="hljs-keyword">var</span> eLeft = $(<span class="hljs-keyword">this</span>).offset().left;
     
     <span class="hljs-keyword">var</span> realTop = eTop - <span class="hljs-number">10</span>;
     $(<span class="hljs-string">'.tip-output'</span>).show();
     <span class="hljs-keyword">var</span> eWidth = $(<span class="hljs-string">'.tip-output'</span>).width();
     <span class="hljs-keyword">var</span> realLeft = eLeft - eWidth - <span class="hljs-number">40</span>;
     $(<span class="hljs-string">'.tip-text'</span>).text(tip);
     $(<span class="hljs-string">'.tip-output'</span>).css(<span class="hljs-string">'top'</span>, realTop + <span class="hljs-string">'px'</span>);
     $(<span class="hljs-string">'.tip-output'</span>).css(<span class="hljs-string">'left'</span>, realLeft + <span class="hljs-string">'px'</span>);
});

$(<span class="hljs-string">'body'</span>).scroll(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    $(<span class="hljs-string">'.tip-output'</span>).hide();
});

$(<span class="hljs-string">'body'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>)</span>{   
       <span class="hljs-keyword">if</span>($(event.target).attr(<span class="hljs-string">'class'</span>) == <span class="hljs-string">"tool-tip"</span>){
          <span class="hljs-keyword">return</span>
       } <span class="hljs-keyword">else</span> {
           $(<span class="hljs-string">'.tip-output'</span>).hide();
       }
});</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Update settings on change</p></div></div><div class="code"><div class="wrapper">    $(<span class="hljs-string">'.driver-input'</span>).change( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> parts = <span class="hljs-keyword">this</span>.id.split(<span class="hljs-string">"-"</span>);
        <span class="hljs-keyword">var</span> new_config = {};
        new_config.driver = {};
        <span class="hljs-keyword">var</span> v = parts[<span class="hljs-number">1</span>];
        <span class="hljs-keyword">if</span>(v === <span class="hljs-string">"gdi"</span>) {
            new_config.driver.gdi = <span class="hljs-keyword">this</span>.value;
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.value == <span class="hljs-number">0</span>) { fabmo.runGCode(<span class="hljs-string">"G90"</span>); }
            <span class="hljs-keyword">else</span> { fabmo.runGCode(<span class="hljs-string">"G91"</span>); }
            fabmo.setConfig(new_config, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) </span>{
                notifyChange(err, data.driver.gid);
                setTimeout(update, <span class="hljs-number">500</span>);
            });
        }
        <span class="hljs-keyword">else</span> {
            setConfig(<span class="hljs-keyword">this</span>.id, <span class="hljs-keyword">this</span>.value);
        }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>How to send G90 or G91 from here?</p></div></div><div class="code"><div class="wrapper">    });

    $(<span class="hljs-string">'#engine-version'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
        evt.preventDefault();
        fabmo.navigate(<span class="hljs-string">'/updater'</span>);
    });

    $(<span class="hljs-string">'.engine-input'</span>).change( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        setConfig(<span class="hljs-keyword">this</span>.id, <span class="hljs-keyword">this</span>.value);
    });

    $(<span class="hljs-string">"#machine-auth_required"</span>).on(<span class="hljs-string">'change'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> ($(<span class="hljs-keyword">this</span>).is(<span class="hljs-string">':checked'</span>)) {
            $(<span class="hljs-keyword">this</span>).attr(<span class="hljs-string">'value'</span>, <span class="hljs-string">'true'</span>);
        } <span class="hljs-keyword">else</span> {
            $(<span class="hljs-keyword">this</span>).attr(<span class="hljs-string">'value'</span>, <span class="hljs-string">'false'</span>);
        }
    });

    $(<span class="hljs-string">"#machine-interlock_required"</span>).on(<span class="hljs-string">'change'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> ($(<span class="hljs-keyword">this</span>).is(<span class="hljs-string">':checked'</span>)) {
            $(<span class="hljs-keyword">this</span>).attr(<span class="hljs-string">'value'</span>, <span class="hljs-string">'true'</span>);
        } <span class="hljs-keyword">else</span> {
            $(<span class="hljs-keyword">this</span>).attr(<span class="hljs-string">'value'</span>, <span class="hljs-string">'false'</span>);
        }
    });

    $(<span class="hljs-string">'.machine-input'</span>).change( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        setConfig(<span class="hljs-keyword">this</span>.id, <span class="hljs-keyword">this</span>.value);
    });

    $(<span class="hljs-string">'.opensbp-input'</span>).change( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        setConfig(<span class="hljs-keyword">this</span>.id, <span class="hljs-keyword">this</span>.value);
    });

    $(<span class="hljs-string">'.opensbp-values'</span>).change( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> parts = <span class="hljs-keyword">this</span>.id.split(<span class="hljs-string">"-"</span>);
        <span class="hljs-keyword">var</span> new_config = {};
        new_config.driver = {};
        <span class="hljs-keyword">var</span> v = parts[<span class="hljs-number">1</span>];

        <span class="hljs-keyword">if</span> (!configData) { <span class="hljs-keyword">return</span>; }
        <span class="hljs-keyword">if</span>(v !== <span class="hljs-literal">undefined</span>) {
            <span class="hljs-keyword">if</span>(v === <span class="hljs-string">"units1"</span>){
                new_config.driver[<span class="hljs-string">'1tr'</span>]=(<span class="hljs-number">360</span>/configData.driver[<span class="hljs-string">"1sa"</span>])*configData.driver[<span class="hljs-string">"1mi"</span>]/<span class="hljs-keyword">this</span>.value;
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(v === <span class="hljs-string">"units2"</span>){
                new_config.driver[<span class="hljs-string">'2tr'</span>]=(<span class="hljs-number">360</span>/configData.driver[<span class="hljs-string">"2sa"</span>])*configData.driver[<span class="hljs-string">"2mi"</span>]/<span class="hljs-keyword">this</span>.value;
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(v === <span class="hljs-string">"units3"</span>){
                new_config.driver[<span class="hljs-string">'3tr'</span>]=(<span class="hljs-number">360</span>/configData.driver[<span class="hljs-string">"3sa"</span>])*configData.driver[<span class="hljs-string">"3mi"</span>]/<span class="hljs-keyword">this</span>.value;
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(v === <span class="hljs-string">"units4"</span>){
                new_config.driver[<span class="hljs-string">'4tr'</span>]=(<span class="hljs-number">360</span>/configData.driver[<span class="hljs-string">"4sa"</span>])*configData.driver[<span class="hljs-string">"4mi"</span>]/<span class="hljs-keyword">this</span>.value;
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(v === <span class="hljs-string">"units5"</span>){
                new_config.driver[<span class="hljs-string">'5tr'</span>]=(<span class="hljs-number">360</span>/configData.driver[<span class="hljs-string">"5sa"</span>])*configData.driver[<span class="hljs-string">"5mi"</span>]/<span class="hljs-keyword">this</span>.value;
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(v === <span class="hljs-string">"units6"</span>){
                new_config.driver[<span class="hljs-string">'6tr'</span>]=(<span class="hljs-number">360</span>/configData.driver[<span class="hljs-string">"6sa"</span>])*configData.driver[<span class="hljs-string">"6mi"</span>]/<span class="hljs-keyword">this</span>.value;
            }
            fabmo.setConfig(new_config, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) </span>{
                notifyChange(err,id);
                setTimeout(update, <span class="hljs-number">500</span>);
            });
        }
    });

    $(<span class="hljs-string">'#input-machine-name'</span>).change( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
        <span class="hljs-keyword">var</span> id = {name: <span class="hljs-keyword">this</span>.value};
        fabmo.setNetworkIdentity(id, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) </span>{
            notifyChange(err,<span class="hljs-string">'input-machine-name'</span>);
            update();
        });

    });</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>setupUserManager();</p></div></div><div class="code"><div class="wrapper">    fabmo.on(<span class="hljs-string">'reconnect'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        update();
    });

    $(<span class="hljs-string">'#profile-listbox'</span>).on(<span class="hljs-string">'change'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
      evt.preventDefault();
      fabmo.showModal({
        title : <span class="hljs-string">'Change Profiles?'</span>,
        message : <span class="hljs-string">'Changing your machine profile will reset all of your apps and settings. Are you sure you want to change profiles?'</span>,
        okText : <span class="hljs-string">'Yes'</span>,
        cancelText : <span class="hljs-string">'No'</span>,
        ok : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
          fabmo.setConfig({engine : {profile : $(<span class="hljs-string">"#profile-listbox option:checked"</span>).val()}});
        },
        cancel : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{}
      });
    });

    setApps(fabmo);
    setUsers(fabmo);
});</div></div></div></div></body></html>