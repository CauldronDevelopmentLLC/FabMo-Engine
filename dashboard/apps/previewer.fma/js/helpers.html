<!DOCTYPE html><html lang="en"><head><title>dashboard/apps/previewer.fma/js/helpers</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../../../"><meta name="groc-document-path" content="dashboard/apps/previewer.fma/js/helpers"><meta name="groc-project-path" content="dashboard/apps/previewer.fma/js/helpers.js"><link rel="stylesheet" type="text/css" media="all" href="../../../../assets/style.css"><script type="text/javascript" src="../../../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">dashboard/apps/previewer.fma/js/helpers.js</div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-comment">/*jslint todo: true, browser: true, continue: true, white: true*/</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Written by Alex Canales for ShopBotTools, Inc.</p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This file contains the class managing the UI helpers (arrows, axis, etc).</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> THREE = <span class="hljs-built_in">require</span>(<span class="hljs-string">"three"</span>);

<span class="hljs-keyword">var</span> Helpers = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scene</span>) </span>{
<span class="hljs-pi">    "use strict"</span>;
    <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;

    <span class="hljs-comment">//Arrows helpers</span>
    that.addArrows = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        that.scene.add(that.arrowX);
        that.scene.add(that.textX);
        that.scene.add(that.arrowY);
        that.scene.add(that.textY);
        that.scene.add(that.arrowZ);
        that.scene.add(that.textZ);
        that.scene.add(that.textZ2);
    };

    that.removeArrows = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        that.scene.remove(that.arrowX);
        that.scene.remove(that.textX);
        that.scene.remove(that.arrowY);
        that.scene.remove(that.textY);
        that.scene.remove(that.arrowZ);
        that.scene.remove(that.textZ);
        that.scene.remove(that.textZ2);
    };

    <span class="hljs-comment">//size is a struct { length, head, font }</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createArrowsHelper</span>(<span class="hljs-params">headSize</span>) </span>{
        <span class="hljs-keyword">var</span> length = <span class="hljs-number">3</span>, fontSize = headSize * <span class="hljs-number">2</span>;
        <span class="hljs-keyword">var</span> options = {<span class="hljs-string">'font'</span> : <span class="hljs-string">'helvetiker'</span>,<span class="hljs-string">'weight'</span> : <span class="hljs-string">'normal'</span>,
            <span class="hljs-string">'style'</span> : <span class="hljs-string">'normal'</span>,<span class="hljs-string">'size'</span> : fontSize,<span class="hljs-string">'curveSegments'</span> : <span class="hljs-number">300</span>};
        <span class="hljs-keyword">var</span> margin = headSize + headSize / <span class="hljs-number">2</span>;

        <span class="hljs-comment">//For X</span>
        <span class="hljs-keyword">var</span> dir = <span class="hljs-keyword">new</span> THREE.Vector3(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
        <span class="hljs-keyword">var</span> origin = <span class="hljs-keyword">new</span> THREE.Vector3(<span class="hljs-number">0</span>, -margin, <span class="hljs-number">0</span>);
        <span class="hljs-keyword">var</span> hex = <span class="hljs-number">0xff0000</span>;
        that.arrowX = <span class="hljs-keyword">new</span> THREE.ArrowHelper(dir, origin, length, hex,
                headSize, headSize);

        <span class="hljs-keyword">var</span> material = <span class="hljs-keyword">new</span> THREE.MeshBasicMaterial({ color: hex,
            side: THREE.DoubleSide });
        <span class="hljs-keyword">var</span> textShapes = THREE.FontUtils.generateShapes(<span class="hljs-string">"X"</span>, options);
        <span class="hljs-keyword">var</span> geo = <span class="hljs-keyword">new</span> THREE.ShapeGeometry(textShapes);
        that.textX = <span class="hljs-keyword">new</span> THREE.Mesh(geo, material);
        that.textX.position.x = origin.x + length + margin;
        that.textX.position.y = origin.y - options.size/<span class="hljs-number">2</span>;
        that.textX.position.z = origin.z;

        <span class="hljs-comment">//For Y</span>
        dir = <span class="hljs-keyword">new</span> THREE.Vector3(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);
        origin = <span class="hljs-keyword">new</span> THREE.Vector3(-margin, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
        hex = <span class="hljs-number">0x00ff00</span>;
        that.arrowY = <span class="hljs-keyword">new</span> THREE.ArrowHelper(dir, origin, length, hex,
                headSize, headSize);

        material = <span class="hljs-keyword">new</span> THREE.MeshBasicMaterial({ color: hex,
            side: THREE.DoubleSide });
        textShapes = THREE.FontUtils.generateShapes(<span class="hljs-string">"Y"</span>, options);
        geo = <span class="hljs-keyword">new</span> THREE.ShapeGeometry(textShapes);
        that.textY = <span class="hljs-keyword">new</span> THREE.Mesh(geo, material);
        that.textY.position.x = origin.x - options.size/<span class="hljs-number">2</span>;
        that.textY.position.y = origin.y + length + margin;
        that.textY.position.z = origin.z;

        <span class="hljs-comment">//For Z</span>
        dir = <span class="hljs-keyword">new</span> THREE.Vector3(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>);
        origin = <span class="hljs-keyword">new</span> THREE.Vector3(-margin, -margin, <span class="hljs-number">0</span>);
        hex = <span class="hljs-number">0x0000ff</span>;
        that.arrowZ = <span class="hljs-keyword">new</span> THREE.ArrowHelper(dir, origin, length, hex,
                headSize, headSize);

        material = <span class="hljs-keyword">new</span> THREE.MeshBasicMaterial({ color: hex });
        textShapes = THREE.FontUtils.generateShapes(<span class="hljs-string">"Z"</span>, options);
        geo = <span class="hljs-keyword">new</span> THREE.ShapeGeometry(textShapes);
        that.textZ = <span class="hljs-keyword">new</span> THREE.Mesh(geo, material);
        that.textZ.position.x = origin.x - options.size/<span class="hljs-number">2</span>;
        that.textZ.position.y = origin.y;
        that.textZ.position.z = origin.z + length + margin;
        that.textZ.rotateX(<span class="hljs-built_in">Math</span>.PI / <span class="hljs-number">2</span>);

        <span class="hljs-comment">//To not see the Z "upside down" change rotating</span>
        that.textZ2 = that.textZ.clone();
        that.textZ2.rotateX(<span class="hljs-built_in">Math</span>.PI);
        that.textZ2.position.z += options.size;
    }

    <span class="hljs-comment">//Redo the meshes to suit with the size</span>
    that.resize = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">totalSize</span>) </span>{
        <span class="hljs-keyword">var</span> xSize = <span class="hljs-number">0</span>, ySize = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">var</span> minSize = <span class="hljs-number">0.25</span>, maxSize = <span class="hljs-number">3</span>, coeff = <span class="hljs-number">40</span>;
        <span class="hljs-keyword">var</span> size = minSize;
        that.removeArrows();

        <span class="hljs-keyword">if</span>(totalSize !== <span class="hljs-literal">undefined</span>) {
            xSize = totalSize.max.x - totalSize.min.x;
            ySize = totalSize.max.y - totalSize.min.y;
            size = <span class="hljs-built_in">Math</span>.max(minSize, <span class="hljs-built_in">Math</span>.max(xSize, ySize) / coeff);
            size = <span class="hljs-built_in">Math</span>.min(maxSize, size);
        }

        createArrowsHelper(size);
        that.addArrows();
    };</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>initialize</p></div></div><div class="code"><div class="wrapper">    that.scene = scene;
    that.resize();
    that.axisHelpers = <span class="hljs-keyword">new</span> THREE.AxisHelper(<span class="hljs-number">100</span>);
    that.scene.add(that.axisHelpers);
};

exports.Helpers = Helpers;</div></div></div></div></body></html>