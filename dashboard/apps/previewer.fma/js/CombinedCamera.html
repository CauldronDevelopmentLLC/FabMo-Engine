<!DOCTYPE html><html lang="en"><head><title>dashboard/apps/previewer.fma/js/CombinedCamera</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../../../"><meta name="groc-document-path" content="dashboard/apps/previewer.fma/js/CombinedCamera"><meta name="groc-project-path" content="dashboard/apps/previewer.fma/js/CombinedCamera.js"><link rel="stylesheet" type="text/css" media="all" href="../../../../assets/style.css"><script type="text/javascript" src="../../../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">dashboard/apps/previewer.fma/js/CombinedCamera.js</div></div><div id="document"><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'> author zz85 / <a href="http://twitter.com/blurspline">http://twitter.com/blurspline</a> / <a href="http://www.lab4games.net/zz85/blog">http://www.lab4games.net/zz85/blog</a></p>
<p>A general perpose camera, for setting FOV, Lens Focal Length,
 and switching between perspective and orthographic views easily.
 Use this only if you do not wish to manage
 both a Orthographic and Perspective Camera</span></p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Modified by Alex Canales.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> THREE = <span class="hljs-built_in">require</span>(<span class="hljs-string">"three"</span>);

<span class="hljs-keyword">var</span> CombinedCamera = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> width, height, fov, near, far, orthoNear, orthoFar </span>) </span>{

    THREE.Camera.call( <span class="hljs-keyword">this</span> );

    <span class="hljs-keyword">this</span>.fov = fov;

    <span class="hljs-keyword">this</span>.left = -width / <span class="hljs-number">2</span>;
    <span class="hljs-keyword">this</span>.right = width / <span class="hljs-number">2</span>;
        <span class="hljs-keyword">this</span>.top = height / <span class="hljs-number">2</span>;
    <span class="hljs-keyword">this</span>.bottom = -height / <span class="hljs-number">2</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>We could also handle the projectionMatrix internally, but just wanted to test nested camera objects</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">this</span>.cameraO = <span class="hljs-keyword">new</span> THREE.OrthographicCamera( width / - <span class="hljs-number">2</span>, width / <span class="hljs-number">2</span>, height / <span class="hljs-number">2</span>, height / - <span class="hljs-number">2</span>, 	orthoNear, orthoFar );
    <span class="hljs-keyword">this</span>.cameraP = <span class="hljs-keyword">new</span> THREE.PerspectiveCamera( fov, width / height, near, far );

    <span class="hljs-keyword">this</span>.zoom = <span class="hljs-number">1</span>;

    <span class="hljs-keyword">this</span>.toPerspective();

    <span class="hljs-keyword">var</span> aspect = width / height;

};

CombinedCamera.prototype = <span class="hljs-built_in">Object</span>.create( THREE.Camera.prototype );
CombinedCamera.prototype.constructor = CombinedCamera;

CombinedCamera.prototype.toPerspective = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Switches to the Perspective Camera</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">this</span>.near = <span class="hljs-keyword">this</span>.cameraP.near;
    <span class="hljs-keyword">this</span>.far = <span class="hljs-keyword">this</span>.cameraP.far;

    <span class="hljs-keyword">this</span>.cameraP.fov =  <span class="hljs-keyword">this</span>.fov / <span class="hljs-keyword">this</span>.zoom ;

    <span class="hljs-keyword">this</span>.cameraP.updateProjectionMatrix();

    <span class="hljs-keyword">this</span>.projectionMatrix = <span class="hljs-keyword">this</span>.cameraP.projectionMatrix;

    <span class="hljs-keyword">this</span>.inPerspectiveMode = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.inOrthographicMode = <span class="hljs-literal">false</span>;

};

CombinedCamera.prototype.toOrthographic = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Switches to the Orthographic camera estimating viewport from Perspective</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">var</span> fov = <span class="hljs-keyword">this</span>.fov;
    <span class="hljs-keyword">var</span> aspect = <span class="hljs-keyword">this</span>.cameraP.aspect;
    <span class="hljs-keyword">var</span> near = <span class="hljs-keyword">this</span>.cameraP.near;
    <span class="hljs-keyword">var</span> far = <span class="hljs-keyword">this</span>.cameraP.far;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The size that we set is the mid plane of the viewing frustum</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">var</span> hyperfocus = ( near + far ) / <span class="hljs-number">2</span>;

    <span class="hljs-keyword">var</span> halfHeight = <span class="hljs-built_in">Math</span>.tan( fov * <span class="hljs-built_in">Math</span>.PI / <span class="hljs-number">180</span> / <span class="hljs-number">2</span> ) * hyperfocus;
    <span class="hljs-keyword">var</span> planeHeight = <span class="hljs-number">2</span> * halfHeight;
    <span class="hljs-keyword">var</span> planeWidth = planeHeight * aspect;
    <span class="hljs-keyword">var</span> halfWidth = planeWidth / <span class="hljs-number">2</span>;

    halfHeight /= <span class="hljs-keyword">this</span>.zoom;
    halfWidth /= <span class="hljs-keyword">this</span>.zoom;

    <span class="hljs-keyword">this</span>.cameraO.left = -halfWidth;
    <span class="hljs-keyword">this</span>.cameraO.right = halfWidth;
    <span class="hljs-keyword">this</span>.cameraO.top = halfHeight;
    <span class="hljs-keyword">this</span>.cameraO.bottom = -halfHeight;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>this.cameraO.left = -farHalfWidth;
this.cameraO.right = farHalfWidth;
this.cameraO.top = farHalfHeight;
this.cameraO.bottom = -farHalfHeight;</p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>this.cameraO.left = this.left / this.zoom;
this.cameraO.right = this.right / this.zoom;
this.cameraO.top = this.top / this.zoom;
this.cameraO.bottom = this.bottom / this.zoom;</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">this</span>.cameraO.updateProjectionMatrix();

    <span class="hljs-keyword">this</span>.near = <span class="hljs-keyword">this</span>.cameraO.near;
    <span class="hljs-keyword">this</span>.far = <span class="hljs-keyword">this</span>.cameraO.far;
    <span class="hljs-keyword">this</span>.projectionMatrix = <span class="hljs-keyword">this</span>.cameraO.projectionMatrix;

    <span class="hljs-keyword">this</span>.inPerspectiveMode = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.inOrthographicMode = <span class="hljs-literal">true</span>;

};


CombinedCamera.prototype.setSize = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> width, height </span>) </span>{

    <span class="hljs-keyword">this</span>.cameraP.aspect = width / height;
    <span class="hljs-keyword">this</span>.left = -width / <span class="hljs-number">2</span>;
    <span class="hljs-keyword">this</span>.right = width / <span class="hljs-number">2</span>;
        <span class="hljs-keyword">this</span>.top = height / <span class="hljs-number">2</span>;
    <span class="hljs-keyword">this</span>.bottom = -height / <span class="hljs-number">2</span>;

};


CombinedCamera.prototype.setFov = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> fov </span>) </span>{

    <span class="hljs-keyword">this</span>.fov = fov;

    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.inPerspectiveMode ) {

        <span class="hljs-keyword">this</span>.toPerspective();

    } <span class="hljs-keyword">else</span> {

        <span class="hljs-keyword">this</span>.toOrthographic();

    }

};</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>For mantaining similar API with PerspectiveCamera</p></div></div><div class="code"><div class="wrapper">CombinedCamera.prototype.updateProjectionMatrix = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.inPerspectiveMode ) {

        <span class="hljs-keyword">this</span>.toPerspective();

    } <span class="hljs-keyword">else</span> {

        <span class="hljs-keyword">this</span>.toPerspective();
        <span class="hljs-keyword">this</span>.toOrthographic();

    }

};</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Uses Focal Length (in mm) to estimate and set FOV
35mm (fullframe) camera is used if frame size is not specified;
Formula based on <a href="http://www.bobatkins.com/photography/technical/field_of_view.html">http://www.bobatkins.com/photography/technical/field_of_view.html</a></p></div></div><div class="code"><div class="wrapper">CombinedCamera.prototype.setLens = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> focalLength, frameHeight </span>) </span>{

    <span class="hljs-keyword">if</span> ( frameHeight === <span class="hljs-literal">undefined</span> ) frameHeight = <span class="hljs-number">24</span>;

    <span class="hljs-keyword">var</span> fov = <span class="hljs-number">2</span> * THREE.Math.radToDeg( <span class="hljs-built_in">Math</span>.atan( frameHeight / ( focalLength * <span class="hljs-number">2</span> ) ) );

    <span class="hljs-keyword">this</span>.setFov( fov );

    <span class="hljs-keyword">return</span> fov;
};


CombinedCamera.prototype.setZoom = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> zoom </span>) </span>{

    <span class="hljs-keyword">this</span>.zoom = zoom;

    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.inPerspectiveMode ) {

        <span class="hljs-keyword">this</span>.toPerspective();

    } <span class="hljs-keyword">else</span> {

        <span class="hljs-keyword">this</span>.toOrthographic();

    }

};

CombinedCamera.prototype.toFrontView = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">this</span>.rotation.x = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.rotation.y = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.rotation.z = <span class="hljs-number">0</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>should we be modifing the matrix instead?</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">this</span>.rotationAutoUpdate = <span class="hljs-literal">false</span>;

};

CombinedCamera.prototype.toBackView = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">this</span>.rotation.x = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.rotation.y = <span class="hljs-built_in">Math</span>.PI;
    <span class="hljs-keyword">this</span>.rotation.z = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.rotationAutoUpdate = <span class="hljs-literal">false</span>;

};

CombinedCamera.prototype.toLeftView = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">this</span>.rotation.x = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.rotation.y = - <span class="hljs-built_in">Math</span>.PI / <span class="hljs-number">2</span>;
    <span class="hljs-keyword">this</span>.rotation.z = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.rotationAutoUpdate = <span class="hljs-literal">false</span>;

};

CombinedCamera.prototype.toRightView = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">this</span>.rotation.x = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.rotation.y = <span class="hljs-built_in">Math</span>.PI / <span class="hljs-number">2</span>;
    <span class="hljs-keyword">this</span>.rotation.z = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.rotationAutoUpdate = <span class="hljs-literal">false</span>;

};

CombinedCamera.prototype.toTopView = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">this</span>.rotation.x = - <span class="hljs-built_in">Math</span>.PI / <span class="hljs-number">2</span>;
    <span class="hljs-keyword">this</span>.rotation.y = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.rotation.z = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.rotationAutoUpdate = <span class="hljs-literal">false</span>;

};

CombinedCamera.prototype.toBottomView = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">this</span>.rotation.x = <span class="hljs-built_in">Math</span>.PI / <span class="hljs-number">2</span>;
    <span class="hljs-keyword">this</span>.rotation.y = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.rotation.z = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.rotationAutoUpdate = <span class="hljs-literal">false</span>;

};

exports.CombinedCamera = CombinedCamera;</div></div></div></div></body></html>