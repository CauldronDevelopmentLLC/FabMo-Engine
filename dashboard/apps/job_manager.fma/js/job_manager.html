<!DOCTYPE html><html lang="en"><head><title>dashboard/apps/job_manager.fma/js/job_manager</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../../../"><meta name="groc-document-path" content="dashboard/apps/job_manager.fma/js/job_manager"><meta name="groc-project-path" content="dashboard/apps/job_manager.fma/js/job_manager.js"><link rel="stylesheet" type="text/css" media="all" href="../../../../assets/style.css"><script type="text/javascript" src="../../../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">dashboard/apps/job_manager.fma/js/job_manager.js</div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-built_in">require</span>(<span class="hljs-string">'./jquery.dragster.js'</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'jquery'</span>);
<span class="hljs-keyword">var</span> Foundation = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../../static/js/libs/foundation.min.js'</span>);
<span class="hljs-keyword">var</span> moment = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../../static/js/libs/moment.js'</span>);
<span class="hljs-keyword">var</span> Sortable = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./Sortable.js'</span>);
<span class="hljs-keyword">var</span> Fabmo = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../../static/js/libs/fabmo.js'</span>);
<span class="hljs-keyword">var</span> fabmo = <span class="hljs-keyword">new</span> Fabmo;
<span class="hljs-keyword">var</span> step;
<span class="hljs-keyword">var</span> testFileSubmitted = <span class="hljs-string">"false"</span>;
<span class="hljs-keyword">var</span> cameFromTour = <span class="hljs-literal">false</span>;
<span class="hljs-keyword">var</span> firstRun = <span class="hljs-literal">true</span>;
<span class="hljs-keyword">var</span> jobLoading = <span class="hljs-literal">false</span>; 
<span class="hljs-keyword">var</span> isTestJob = <span class="hljs-string">''</span>;
<span class="hljs-keyword">var</span> tourComplete = <span class="hljs-literal">false</span>;
<span class="hljs-keyword">var</span> numberJobs = <span class="hljs-number">0</span>;
<span class="hljs-keyword">var</span> x = <span class="hljs-number">0</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Current position in the history browser</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> historyStart = <span class="hljs-number">0</span>;
<span class="hljs-keyword">var</span> historyCount = <span class="hljs-number">10</span>;
<span class="hljs-keyword">var</span> historyTotal = <span class="hljs-number">0</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Timer for the running job indicator</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> blinkTimer = <span class="hljs-literal">null</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The currently running Job ID</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> currentJobId = -<span class="hljs-number">1</span>;
<span class="hljs-keyword">var</span> currentStatus = {};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fileUploadProgress</span>(<span class="hljs-params">progress</span>) </span>{
  <span class="hljs-keyword">var</span> pg = (progress * <span class="hljs-number">100</span>).toFixed(<span class="hljs-number">0</span>) + <span class="hljs-string">'%'</span>;
  $(<span class="hljs-string">'.progressbar .bar-fill'</span>).width(pg);
  <span class="hljs-keyword">if</span> (progress === <span class="hljs-number">1</span>) {
    setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      $(<span class="hljs-string">'.progressbar'</span>).addClass(<span class="hljs-string">'hide'</span>);
      $(<span class="hljs-string">'.progressbar .bar-fill'</span>).width(<span class="hljs-number">0</span>);
    }, <span class="hljs-number">200</span>);
  }
}


<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setupDropTarget</span>(<span class="hljs-params"></span>) </span>{
  $(<span class="hljs-string">'#tabpending'</span>).dragster({
    enter: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">devt, evt</span>) </span>{
      $(<span class="hljs-string">'#tabpending'</span>).addClass(<span class="hljs-string">'hover'</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    },

    leave: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">devt, evt</span>) </span>{
      $(<span class="hljs-string">'#tabpending'</span>).removeClass(<span class="hljs-string">'hover'</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    },
    drop: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">devt, evt</span>) </span>{
      evt.preventDefault();
      <span class="hljs-keyword">try</span> {
        file = evt.originalEvent.dataTransfer.files;
        <span class="hljs-keyword">if</span> (file.length &gt; <span class="hljs-number">0</span>) {
          <span class="hljs-keyword">var</span> file_size = file[<span class="hljs-number">0</span>].size;
          $(<span class="hljs-string">'.progressbar'</span>).removeClass(<span class="hljs-string">'hide'</span>);
          fabmo.on(<span class="hljs-string">'upload_progress'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">progress</span>) </span>{
            fileUploadProgress(progress.value);
          });
          fabmo.submitJob(file, {
            compressed: file.size &gt; <span class="hljs-number">2000000</span> ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>
          }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) </span>{
            <span class="hljs-keyword">if</span> (err) {
              <span class="hljs-built_in">console</span>.log(err);
              fabmo.notify(<span class="hljs-string">'error'</span>, err);
              <span class="hljs-keyword">return</span>
            } <span class="hljs-keyword">else</span> {
              updateQueue()
            }
          });
        }
      } <span class="hljs-keyword">catch</span> (e) {
      } <span class="hljs-keyword">finally</span> {
        $(<span class="hljs-string">'#tabpending'</span>).removeClass(<span class="hljs-string">'hover'</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      }
    }
  });
}</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>function synchJobSubmit(files) {
  fabmo.submitJob(files[x], {
    compressed: files[x].size &gt; 2000000 ? true : false
  }, function(err, data) {
    if (err) {
      console.log(err);
      fabmo.notify(&#39;error&#39;, err);</p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><pre><code>  return
} else {
  x++;
  if (x &lt; files.length) {
    synchJobSubmit(files);
  } else {
    updateQueue();
    x = 0;
  }
}</code></pre></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>  });</p></div></div><div class="code"><div class="wrapper"><span class="hljs-comment">// </span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateQueue</span>(<span class="hljs-params">callback</span>) </span>{
  callback = callback || <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{};</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Update the queue display.</p></div></div><div class="code"><div class="wrapper">  fabmo.getJobsInQueue(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, jobs</span>) </span>{
    numberJobs = jobs.pending.length;
    <span class="hljs-keyword">var</span> jobElements = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"queue_table"</span>).childElementCount;
    <span class="hljs-keyword">if</span> (err) {
      <span class="hljs-keyword">return</span> callback(err);
    }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>if (jobs.pending.length === jobElements &amp;&amp; jobs.pending.length != 0 &amp;&amp; jobs.running.length === 0) {
  return</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-comment">// else {</span>
      jobs.pending.sort(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a, b</span>) </span>{
        <span class="hljs-keyword">return</span> a.order - b.order;
      });
      <span class="hljs-keyword">if</span> (jobs.running.length) {
        <span class="hljs-keyword">var</span> current = jobs.running[<span class="hljs-number">0</span>];
        jobs.pending.unshift(current);
        addQueueEntries(jobs.pending);
        runningJob(current);
      } <span class="hljs-keyword">else</span> {
        runningJob(<span class="hljs-literal">null</span>);
        addQueueEntries(jobs.pending);
      }
    <span class="hljs-comment">// </span>
    callback();
  });

}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clearQueue</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> elements = <span class="hljs-built_in">document</span>.getElementsByClassName(<span class="hljs-string">'job_item'</span>);
  <span class="hljs-keyword">while</span> (elements.length &gt; <span class="hljs-number">0</span>) {
    elements[<span class="hljs-number">0</span>].parentNode.removeChild(elements[<span class="hljs-number">0</span>]);
  }
  updateOrder();
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clearRecent</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> elements = <span class="hljs-built_in">document</span>.getElementsByClassName(<span class="hljs-string">'recent_item'</span>);
  <span class="hljs-keyword">while</span> (elements.length &gt; <span class="hljs-number">0</span>) {
    elements[<span class="hljs-number">0</span>].parentNode.removeChild(elements[<span class="hljs-number">0</span>]);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createQueueMenu</span>(<span class="hljs-params">id</span>) </span>{
  <span class="hljs-keyword">var</span> menu = <span class="hljs-string">"&lt;div data-jobid='JOBID' class='ellipses' title='more actions'&gt;&lt;span&gt;...&lt;/span&gt;&lt;/div&gt;&lt;div class='commentBox'&gt;&lt;/div&gt;&lt;div class='dropDown'&gt;&lt;ul class='jobActions'&gt;&lt;li&gt;&lt;a class='previewJob' data-jobid='JOBID'&gt;Preview Job&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a class='editJob' data-jobid='JOBID'&gt;Edit Job&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a class='downloadJob' data-jobid='JOBID'&gt;Download Job&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a class='deleteJob' data-jobid='JOBID'&gt;Delete Job&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;"</span>;
  <span class="hljs-keyword">return</span> menu.replace(<span class="hljs-regexp">/JOBID/g</span>, id);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createRecentMenu</span>(<span class="hljs-params">id</span>) </span>{
  <span class="hljs-keyword">var</span> menu = <span class="hljs-string">"&lt;div  class='ellipses' title='Run Again'&gt;&lt;i data-jobid='JOBID'class='fa fa-arrow-circle-up add resubmitJob' aria-hidden='true'&gt;&lt;/i&gt;&lt;/div&gt;"</span>;
  <span class="hljs-keyword">return</span> menu.replace(<span class="hljs-regexp">/JOBID/g</span>, id);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">makeActions</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> actions = <span class="hljs-string">'&lt;div&gt; &lt;div class="small-2 medium-4 columns play-button" style="text-align:right;"&gt; &lt;div class="radial_progress"&gt; &lt;div class="perecent_circle"&gt; &lt;div class="mask full"&gt;&lt;div class="fill"&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="mask half"&gt;&lt;div class="fill"&gt;&lt;/div&gt;&lt;div class="fill fix"&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class="shadow"&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class="inset"&gt; &lt;div id="run-next" class="play"&gt;&lt;span&gt;&lt;/span&gt;&lt;/div&gt; &lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="small-8 medium-12 icon-row" sortable="false"&gt;&lt;div class="medium-1 small-2 columns"&gt;&lt;a class="preview" title="Preview Job"&gt;&lt;img  class="svg" src="css/images/visible9.svg"&gt;&lt;/a&gt;&lt;/div&gt;&lt;div class="medium-1 small-2 columns"&gt;&lt;a class="edit" title="Edit Job"&gt;&lt;img class="svg" src="images/edit_icon.png"&gt;&lt;/a&gt;&lt;/div&gt;&lt;div class="medium-1 small-2 columns"&gt;&lt;a class="download" title="Download Job"&gt;&lt;img  class="svg" src="css/images/download151.svg"&gt;&lt;/a&gt;&lt;/div&gt;&lt;div class="medium-1 small-2 columns"&gt;&lt;a class="cancel" title="Cancel Job"&gt;&lt;img  class="svg" src="css/images/recycling10.svg"&gt;&lt;/a&gt;&lt;/div&gt;&lt;div class="sm-1 columns"&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="row"&gt;&lt;/div&gt;&lt;div class="job-lights-container"&gt;&lt;div class="job-status-light one off"&gt;&lt;div class="job-status-indicator"&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="job-status-light two off"&gt;&lt;div class="job-status-indicator"&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="job-status-light three off"&gt;&lt;div class="job-status-indicator"&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;'</span>
  <span class="hljs-keyword">return</span> actions;
}</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Returns an img string DOM element for holding the job preview thumbnail.
function createPreviewThumbnail(job, width, height) {
  var img = document.createElement(&quot;img&quot;);
  img.style.marginRight = &quot;4px&quot;;
  img.width = width;
  img.height = height;
  img.alt = &quot;[No possible preview]&quot;;
  img.src = &quot;/job/&quot; + job._id + &quot;/thumbnail&quot;;
  return img.outerHTML;</p></div></div><div class="code"><div class="wrapper"><span class="hljs-comment">// </span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">search</span>(<span class="hljs-params">nameKey, arr</span>) </span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; arr.length; i++) {
    <span class="hljs-keyword">if</span> (arr[i]._id.toString() === nameKey) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addQueueEntries</span>(<span class="hljs-params">jobs</span>) </span>{
  <span class="hljs-keyword">var</span> elements = <span class="hljs-built_in">document</span>.getElementsByClassName(<span class="hljs-string">'job_item'</span>); <span class="hljs-comment">//All current jobs in DOM</span>
  <span class="hljs-keyword">var</span> table = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'queue_table'</span>);
  <span class="hljs-keyword">var</span> recent = [];


  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; elements.length; j++) { <span class="hljs-comment">/// If a job is in the DOM and is not pending remove it</span>
    <span class="hljs-keyword">var</span> found = search(elements[j].id, jobs);
    <span class="hljs-keyword">if</span> (found) {

    } <span class="hljs-keyword">else</span> {
      $(<span class="hljs-string">'#'</span> + elements[j].id).remove();
    }
  }


  <span class="hljs-keyword">if</span> (jobs.length) {
    $(<span class="hljs-string">'.no-jobs'</span>).css(<span class="hljs-string">'left'</span>, <span class="hljs-string">'-2000px'</span>); <span class="hljs-comment">/// Remove no jobs menu</span>
    nextJob();
    <span class="hljs-comment">/// add logic to check if these exist in right order</span>
    clearQueue();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; jobs.length; i++) {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>if ($(&#39;#&#39; + jobs[i]._id).length &lt; 1) { // If a job already has a card do nothing else make a card for job</p></div></div><div class="code"><div class="wrapper">        <span class="hljs-keyword">var</span> listItem = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">"div"</span>);
        listItem.setAttribute(<span class="hljs-string">"id"</span>, jobs[i]._id);
        listItem.setAttribute(<span class="hljs-string">"class"</span>, <span class="hljs-string">"job_item"</span>);
        listItem.setAttribute(<span class="hljs-string">"data-id"</span>, jobs[i]._id);
        table.appendChild(listItem);
        <span class="hljs-keyword">var</span> id = <span class="hljs-built_in">document</span>.getElementById(jobs[i]._id);
        id.innerHTML = <span class="hljs-string">'&lt;div id="menu"&gt;&lt;/div&gt;&lt;div class="job_name"&gt;'</span> + jobs[i].name + <span class="hljs-string">'&lt;/div&gt;&lt;div class="description"&gt;'</span> + jobs[i].description + <span class="hljs-string">'&lt;/div&gt;&lt;div class="created-date"&gt;'</span>+ moment(jobs[i].created_at).fromNow(); +<span class="hljs-string">'&lt;/div&gt;'</span>;
        <span class="hljs-keyword">var</span> menu = id.firstChild;
        menu.innerHTML = createQueueMenu(jobs[i]._id);
      <span class="hljs-comment">// </span>
    };
    setFirstCard(); <span class="hljs-comment">//Add play button and css style for first card</span>
    isTestJob = jobs[<span class="hljs-number">0</span>];
    bindMenuEvents();
  } <span class="hljs-keyword">else</span> {
    clearQueue();
    $(<span class="hljs-string">'.no-jobs'</span>).css(<span class="hljs-string">'left'</span>, <span class="hljs-string">'0px'</span>);
    fabmo.getJobHistory({
      start: <span class="hljs-number">0</span>,
      count: <span class="hljs-number">0</span>
    }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, jobs</span>) </span>{
      <span class="hljs-keyword">var</span> arr = jobs.data;
      <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> a = <span class="hljs-number">0</span>; a &lt; arr.length; a++) {
        <span class="hljs-keyword">if</span> (i === <span class="hljs-number">4</span>) {
          <span class="hljs-keyword">break</span>;
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">var</span> result = recent.filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
            <span class="hljs-keyword">return</span> e.file_id == arr[a].file_id;
          });
          <span class="hljs-keyword">if</span> (result.length === <span class="hljs-number">0</span>) {
            recent.push(arr[a]);
            i++;
          }
        }
      }
      <span class="hljs-keyword">var</span> recentJobs = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'recent'</span>);
      clearRecent();
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; recent.length; i++) {
        <span class="hljs-keyword">var</span> recentItem = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">"div"</span>);
        recentItem.setAttribute(<span class="hljs-string">"id"</span>, recent[i]._id);
        recentItem.setAttribute(<span class="hljs-string">"class"</span>, <span class="hljs-string">"recent_item"</span>);
        recentItem.setAttribute(<span class="hljs-string">"data-id"</span>, recent[i]._id);
        recentJobs.appendChild(recentItem);
        <span class="hljs-keyword">var</span> id = <span class="hljs-built_in">document</span>.getElementById(recent[i]._id);
        id.innerHTML = <span class="hljs-string">'&lt;div id="menu"&gt;&lt;/div&gt;&lt;div id="name"&gt;'</span> + recent[i].name + <span class="hljs-string">'&lt;/div&gt;&lt;div class="description"&gt;'</span> + recent[i].description + <span class="hljs-string">'&lt;/div&gt;&lt;div class="created-date"&gt;Last Run: '</span>+ moment(recent[i].created_at).fromNow(); +<span class="hljs-string">'&lt;/div&gt;'</span>;
        <span class="hljs-keyword">var</span> menu = id.firstChild;


        menu.innerHTML = createRecentMenu(recent[i]._id);

      };
      bindMenuEvents();

      <span class="hljs-keyword">if</span> (err) {
        <span class="hljs-keyword">return</span> callback(err);
      }
    });
  }
  setStep(tour);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setFirstCard</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> firstId = $(<span class="hljs-string">'.job_item'</span>).first().attr(<span class="hljs-string">'id'</span>);
  <span class="hljs-keyword">var</span> el = <span class="hljs-built_in">document</span>.getElementById(firstId);
  <span class="hljs-keyword">var</span> cardActions = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">"div"</span>);
  cardActions.setAttribute(<span class="hljs-string">"id"</span>, <span class="hljs-string">"actions"</span>);
  el.appendChild(cardActions);
  <span class="hljs-keyword">var</span> actions = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"actions"</span>);
  actions.innerHTML = makeActions();
  $(<span class="hljs-string">'.cancel'</span>).data(<span class="hljs-string">'id'</span>, firstId);
  $(<span class="hljs-string">'.preview'</span>).data(<span class="hljs-string">'id'</span>, firstId);
  $(<span class="hljs-string">'.download'</span>).data(<span class="hljs-string">'id'</span>, firstId);
  $(<span class="hljs-string">'.edit'</span>).data(<span class="hljs-string">'id'</span>, firstId);

}</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr>
<h2 id="-history">  HISTORY</h2></div></div><div class="code"><div class="wrapper"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateHistory</span>(<span class="hljs-params">callback</span>) </span>{
  fabmo.getJobHistory({
    start: historyStart,
    count: historyCount
  }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, jobs</span>) </span>{
    <span class="hljs-keyword">if</span> (err) {
      <span class="hljs-keyword">return</span> callback(err);
    }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Hide/show the next/prev buttons according to the history total</p></div></div><div class="code"><div class="wrapper">    historyTotal = jobs.total_count;
    $(<span class="hljs-string">'#history_page_next'</span>).toggle(historyTotal &gt; (historyStart + historyCount));
    $(<span class="hljs-string">'#history_page_prev'</span>).toggle(historyStart &gt; <span class="hljs-number">0</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Eliminate entries in the table and repopulate with fresh data</p></div></div><div class="code"><div class="wrapper">    clearHistory();
    addHistoryEntries(jobs.data);
    <span class="hljs-keyword">typeof</span> callback === <span class="hljs-string">'function'</span> &amp;&amp; callback();
  });
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">historyPreviousPage</span>(<span class="hljs-params">callback</span>) </span>{
  historyStart -= historyCount;
  <span class="hljs-keyword">if</span> (historyStart &lt; <span class="hljs-number">0</span>) {
    historyStart = <span class="hljs-number">0</span>;
  }
  updateHistory(callback);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">historyNextPage</span>(<span class="hljs-params">callback</span>) </span>{
  historyStart += historyCount;
  updateHistory(callback);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clearHistory</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> table = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'history_table'</span>);
  <span class="hljs-keyword">var</span> rows = table.rows.length;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; rows; i++) {
    table.deleteRow(<span class="hljs-number">0</span>);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createHistoryMenu</span>(<span class="hljs-params">id</span>) </span>{
  <span class="hljs-keyword">var</span> menu = <span class="hljs-string">"&lt;div class='ellipses' title='More Actions'&gt;&lt;span&gt;...&lt;/span&gt;&lt;/div&gt;&lt;div class='commentBox'&gt;&lt;/div&gt;&lt;div class='dropDown'&gt;&lt;ul class='jobActions'&gt;&lt;li&gt;&lt;a class='previewJob' data-jobid='JOBID'&gt;Preview Job&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a class='editJob' data-jobid='JOBID'&gt;Edit Job&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a class='resubmitJob' data-jobid='JOBID'&gt;Add To Queue&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a class='downloadJob' data-jobid='JOBID'&gt;Download Job&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a class='deleteJob' data-jobid='JOBID'&gt;Delete Job&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;"</span>
  <span class="hljs-keyword">return</span> menu.replace(<span class="hljs-regexp">/JOBID/g</span>, id)
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addHistoryEntries</span>(<span class="hljs-params">jobs</span>) </span>{
  <span class="hljs-keyword">var</span> table = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'history_table'</span>);
  jobs.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">job</span>) </span>{
    <span class="hljs-keyword">var</span> row = table.insertRow(table.rows.length);
    <span class="hljs-keyword">var</span> menu = row.insertCell(<span class="hljs-number">0</span>);
    menu.className += <span class="hljs-string">' actions-control'</span>;
    <span class="hljs-keyword">var</span> thumbnail = row.insertCell(<span class="hljs-number">1</span>);
    thumbnail.style.width = <span class="hljs-string">"60px"</span>;
    <span class="hljs-keyword">var</span> name = row.insertCell(<span class="hljs-number">2</span>);
    <span class="hljs-keyword">var</span> done = row.insertCell(<span class="hljs-number">3</span>);
    <span class="hljs-keyword">var</span> time = row.insertCell(<span class="hljs-number">4</span>);

    menu.innerHTML = createHistoryMenu(job._id);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>thumbnail.innerHTML = createPreviewThumbnail(job, 50, 50);</p></div></div><div class="code"><div class="wrapper">    name.innerHTML = <span class="hljs-string">'&lt;div class="job-'</span> + job.state + <span class="hljs-string">'"&gt;'</span> + job.name + <span class="hljs-string">'&lt;/div&gt;'</span>;
    done.innerHTML = moment(job.finished_at).fromNow();
    time.innerHTML = moment.utc(job.finished_at - job.started_at).format(<span class="hljs-string">'HH:mm:ss'</span>);
  });
  bindMenuEvents();
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hideDropDown</span>(<span class="hljs-params"></span>) </span>{
  $(<span class="hljs-string">'.dropDownWrapper'</span>).hide();
  $(<span class="hljs-string">'.dropDown'</span>).hide();
  $(<span class="hljs-string">'.commentBox'</span>).hide();
}


<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">bindMenuEvents</span>(<span class="hljs-params"></span>) </span>{

  $(<span class="hljs-string">'.resubmitJob'</span>).off(<span class="hljs-string">'click'</span>);
  $(<span class="hljs-string">'.resubmitJob'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    fabmo.resubmitJob(<span class="hljs-keyword">this</span>.dataset.jobid, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, result</span>) </span>{
      <span class="hljs-comment">//refresh_jobs_list();</span>
      updateOrder();
      fabmo.getJobsInQueue(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) </span>{
        $(<span class="hljs-string">'.toggle-topbar'</span>).click();
        $(<span class="hljs-string">'#nav-pending'</span>).click();
        updateQueue(<span class="hljs-literal">false</span>);
      });
    });
    hideDropDown();
  });




  $(<span class="hljs-string">'.previewJob'</span>).off(<span class="hljs-string">'click'</span>);
  $(<span class="hljs-string">'.previewJob'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    e.preventDefault();
    fabmo.launchApp(<span class="hljs-string">'previewer'</span>, {
      <span class="hljs-string">'job'</span>: <span class="hljs-keyword">this</span>.dataset.jobid
    });
    hideDropDown();
  });

  $(<span class="hljs-string">'.editJob'</span>).off(<span class="hljs-string">'click'</span>);
  $(<span class="hljs-string">'.editJob'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    e.preventDefault();
    fabmo.launchApp(<span class="hljs-string">'editor'</span>, {
      <span class="hljs-string">'job'</span>: <span class="hljs-keyword">this</span>.dataset.jobid
    });
    hideDropDown();
  });

  $(<span class="hljs-string">'.downloadJob'</span>).off(<span class="hljs-string">'click'</span>)
  $(<span class="hljs-string">'.downloadJob'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    fabmo.navigate(<span class="hljs-string">'/job/'</span> + <span class="hljs-keyword">this</span>.dataset.jobid + <span class="hljs-string">'/file'</span>);
  });

  $(<span class="hljs-string">'.deleteJob'</span>).off(<span class="hljs-string">'click'</span>)
  $(<span class="hljs-string">'.deleteJob'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    fabmo.deleteJob(<span class="hljs-keyword">this</span>.dataset.jobid, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err,data</span>)</span>{
      <span class="hljs-keyword">if</span>(err){
        <span class="hljs-built_in">console</span>.log(err);
      } <span class="hljs-keyword">else</span> {
        updateQueue();
        updateHistory();
        updateOrder();
      }
    });

  });

  $(<span class="hljs-string">'.dropDownWrapper'</span>).off(<span class="hljs-string">'click'</span>)
  $(<span class="hljs-string">'.dropDownWrapper'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    hideDropDown();
  });

  $(<span class="hljs-string">'.ellipses'</span>).off(<span class="hljs-string">'click'</span>)
  $(<span class="hljs-string">'.ellipses'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
    <span class="hljs-comment">//create and show a transparent overlay that you can click to close</span>
    $(<span class="hljs-string">'.dropDownWrapper'</span>).show();
    <span class="hljs-keyword">var</span> dd = $(<span class="hljs-keyword">this</span>).nextAll();
    dd.show();
  });
}


<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">noJob</span>(<span class="hljs-params"></span>) </span>{
  $(<span class="hljs-string">'.with-job'</span>).data(<span class="hljs-string">'job'</span>, <span class="hljs-literal">false</span>);
  $(<span class="hljs-string">'.up-next'</span>).css(<span class="hljs-string">'left'</span>, <span class="hljs-string">'-2000px'</span>);
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">nextJob</span>(<span class="hljs-params">job</span>) </span>{
  $(<span class="hljs-string">'.with-job'</span>).data(<span class="hljs-string">'job'</span>, <span class="hljs-literal">true</span>);
  $(<span class="hljs-string">'.with-job'</span>).css(<span class="hljs-string">'left'</span>, <span class="hljs-string">'10px'</span>);
  $(<span class="hljs-string">'.up-next'</span>).css(<span class="hljs-string">'left'</span>, <span class="hljs-string">'0px'</span>);
};</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Job should be the running job or null</p></div></div><div class="code"><div class="wrapper"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">runningJob</span>(<span class="hljs-params">job</span>) </span>{
  <span class="hljs-keyword">if</span> (!job) {
    setProgress(status);
    $(<span class="hljs-string">'.play'</span>).removeClass(<span class="hljs-string">'active'</span>)
    $(<span class="hljs-string">'body'</span>).css(<span class="hljs-string">'background-color'</span>, <span class="hljs-string">'#EEEEEE'</span>);
    $(<span class="hljs-string">'.play-button'</span>).show();
    sortable.options.disabled = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">return</span>
  }

  $(<span class="hljs-string">'.cancel'</span>).slideUp(<span class="hljs-number">100</span>);
  $(<span class="hljs-string">'.download'</span>).slideUp(<span class="hljs-number">100</span>);
  $(<span class="hljs-string">'.edit'</span>).slideUp(<span class="hljs-number">100</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>$(&#39;.preview&#39;).slideUp(100); // Here if the live viewer button moves</p></div></div><div class="code"><div class="wrapper">  $(<span class="hljs-string">'.preview'</span>).off(<span class="hljs-string">'click'</span>);
  $(<span class="hljs-string">'.preview'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    e.preventDefault();
    fabmo.launchApp(<span class="hljs-string">'previewer'</span>, {
      <span class="hljs-string">'job'</span>: job._id,
      <span class="hljs-string">"isLive"</span>: <span class="hljs-literal">true</span>
    });
    hideDropDown();
  });

  $(<span class="hljs-string">'body'</span>).css(<span class="hljs-string">'background-color'</span>, <span class="hljs-string">'#898989'</span>);
  $(<span class="hljs-string">'.topjob'</span>).addClass(<span class="hljs-string">'running'</span>);
  $(<span class="hljs-string">'.up-next'</span>).css(<span class="hljs-string">'left'</span>, <span class="hljs-string">'-2000px'</span>);
  $(<span class="hljs-string">'.no-jobs'</span>).css(<span class="hljs-string">'left'</span>, <span class="hljs-string">'-2000px'</span>);
  $(<span class="hljs-string">'.now-running'</span>).css(<span class="hljs-string">'left'</span>, <span class="hljs-string">'0px'</span>);
  $(<span class="hljs-string">'.play-button'</span>).show();
  <span class="hljs-keyword">if</span> (!$(<span class="hljs-string">'.play'</span>).hasClass(<span class="hljs-string">'active'</span>)){
    $(<span class="hljs-string">'.play'</span>).addClass(<span class="hljs-string">'active'</span>);
  }
  sortable.options.disabled = <span class="hljs-literal">true</span>;
};

<span class="hljs-keyword">var</span> setProgress = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">status</span>) </span>{
  <span class="hljs-keyword">var</span> prog = ((status.line / status.nb_lines) * <span class="hljs-number">100</span>).toFixed(<span class="hljs-number">2</span>);
  <span class="hljs-keyword">if</span> (prog &gt; <span class="hljs-number">100</span>) {
    prog = <span class="hljs-number">100</span>;
  }
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">isNaN</span>(prog)) {
    prog = <span class="hljs-number">0</span>;
  }
  <span class="hljs-keyword">var</span> percent = <span class="hljs-built_in">Math</span>.ceil(prog);
  <span class="hljs-keyword">var</span> rotation = <span class="hljs-built_in">Math</span>.ceil(<span class="hljs-number">180</span> * (percent / <span class="hljs-number">100</span>));
  <span class="hljs-keyword">var</span> fill_rotation = rotation;
  <span class="hljs-keyword">var</span> fix_rotation = rotation * <span class="hljs-number">2</span>;
  <span class="hljs-keyword">var</span> transform_styles = [<span class="hljs-string">'-webkit-transform'</span>, <span class="hljs-string">'-ms-transform'</span>, <span class="hljs-string">'transform'</span>];
  <span class="hljs-keyword">if</span> (!status.job) {
    $(<span class="hljs-string">'.up-next'</span>).css(<span class="hljs-string">'left'</span>, <span class="hljs-string">'-2000px'</span>);
    $(<span class="hljs-string">'.now-running'</span>).css(<span class="hljs-string">'left'</span>, <span class="hljs-string">'-2000px'</span>);

    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> transform_styles) {
      $(<span class="hljs-string">'.fill, .mask.full'</span>).css(transform_styles[i], <span class="hljs-string">'rotate(0deg)'</span>);
      $(<span class="hljs-string">'.fill.fix'</span>).css(transform_styles[i], <span class="hljs-string">'rotate(0deg)'</span>);
    }

  }
  <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> transform_styles) {
    $(<span class="hljs-string">'.fill, .mask.full'</span>).css(transform_styles[i], <span class="hljs-string">'rotate('</span> + fill_rotation + <span class="hljs-string">'deg)'</span>);
    $(<span class="hljs-string">'.fill.fix'</span>).css(transform_styles[i], <span class="hljs-string">'rotate('</span> + fix_rotation + <span class="hljs-string">'deg)'</span>);
  }
}</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr>
<h2 id="-status"> STATUS</h2></div></div><div class="code"><div class="wrapper"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleStatusReport</span>(<span class="hljs-params">status</span>) </span>{</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Either we&#39;re running a job currently or null</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">var</span> jobId = status.job._id || <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">var</span> jobState = status.state;

  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-keyword">var</span> jobid = <span class="hljs-literal">null</span>;
  }

  <span class="hljs-keyword">if</span> (jobId &amp;&amp; jobState === <span class="hljs-string">"running"</span>) { <span class="hljs-comment">// Job is currently running</span>
    setProgress(status);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateOrder</span>(<span class="hljs-params"></span>)</span>{
  <span class="hljs-keyword">var</span> newOrder = sortable.toArray();
  fabmo.getJobsInQueue(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, jobs</span>) </span>{
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; newOrder.length; i++) {
      <span class="hljs-keyword">var</span> id = jobs.pending.filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">id</span>) </span>{
        <span class="hljs-keyword">return</span> id._id == newOrder[i];
      });
      id[<span class="hljs-number">0</span>].order = i + <span class="hljs-number">1</span>;
      fabmo.updateOrder({
        id: id[<span class="hljs-number">0</span>]._id,
        order: id[<span class="hljs-number">0</span>].order
      }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, result</span>) </span>{
        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-built_in">console</span>.log(err);
        } <span class="hljs-keyword">else</span> {
          updateQueue();
        }
      });
    }
  });
}



<span class="hljs-keyword">var</span> el = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'queue_table'</span>);
<span class="hljs-keyword">var</span> sortable = Sortable.create(el, {
  ghostClass: <span class="hljs-string">'ghost'</span>,
  chosenClass: <span class="hljs-string">'chosen'</span>,
  dataIdAttr: <span class="hljs-string">'data-id'</span>,
  clickDelay: <span class="hljs-number">0</span>,
  touchDelay: <span class="hljs-number">100</span>,
  animation: <span class="hljs-number">150</span>,
  filter: <span class="hljs-string">".cancel, .preview, .edit, .download, .play, .previewJob, .editJob, .downloadJob, .deleteJob, .ellipses"</span>,
  onStart: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
    <span class="hljs-keyword">var</span> remove = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'actions'</span>);
    remove.parentNode.removeChild(remove);
    <span class="hljs-keyword">var</span> ctrl = evt.item;
    ctrl.removeAttribute(<span class="hljs-string">"style"</span>);
  },
  onFilter: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
    <span class="hljs-keyword">var</span> item = evt.item,
      ctrl = evt.target;
    <span class="hljs-keyword">var</span> id = ctrl.getAttribute(<span class="hljs-string">'data-jobid'</span>);
    <span class="hljs-keyword">if</span> (Sortable.utils.is(ctrl, <span class="hljs-string">".cancel"</span>)) {
      fabmo.deleteJob($(<span class="hljs-string">'.cancel'</span>).data(<span class="hljs-string">'id'</span>), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) </span>{
        updateQueue();
        updateHistory();

      });
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Sortable.utils.is(ctrl, <span class="hljs-string">".preview"</span>)) {
      fabmo.launchApp(<span class="hljs-string">'previewer'</span>, {
        <span class="hljs-string">'job'</span>: $(<span class="hljs-string">'.preview'</span>).data(<span class="hljs-string">'id'</span>)
      });
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Sortable.utils.is(ctrl, <span class="hljs-string">".edit"</span>)) {
      fabmo.launchApp(<span class="hljs-string">'editor'</span>, {
        <span class="hljs-string">'job'</span>: $(<span class="hljs-string">'.edit'</span>).data(<span class="hljs-string">'id'</span>)
      });
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Sortable.utils.is(ctrl, <span class="hljs-string">".download"</span>)) {
      $(<span class="hljs-string">'.download'</span>).attr({
        <span class="hljs-string">'data-href'</span>: <span class="hljs-string">'/job/'</span> + $(<span class="hljs-string">'.download'</span>).data(<span class="hljs-string">'id'</span>) + <span class="hljs-string">'/file'</span>
      });
      fabmo.navigate($(<span class="hljs-string">'.download'</span>).data(<span class="hljs-string">'href'</span>));
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Sortable.utils.is(ctrl, <span class="hljs-string">".ellipses"</span>)) {
      <span class="hljs-keyword">var</span> dd = ctrl.parentNode.childNodes[<span class="hljs-number">2</span>];
      <span class="hljs-keyword">var</span> cd = ctrl.parentNode.childNodes[<span class="hljs-number">1</span>];
      $(<span class="hljs-string">'.dropDownWrapper'</span>).show();
      dd.style.display = <span class="hljs-string">'block'</span>;
      cd.style.display = <span class="hljs-string">'block'</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Sortable.utils.is(ctrl, <span class="hljs-string">".previewJob"</span>)) {
      fabmo.launchApp(<span class="hljs-string">'previewer'</span>, {
        <span class="hljs-string">'job'</span>: id
      });
      hideDropDown();
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Sortable.utils.is(ctrl, <span class="hljs-string">".editJob"</span>)) {
      fabmo.launchApp(<span class="hljs-string">'editor'</span>, {
        <span class="hljs-string">'job'</span>: id
      });
      hideDropDown();
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Sortable.utils.is(ctrl, <span class="hljs-string">".downloadJob"</span>)) {
      fabmo.navigate(<span class="hljs-string">'/job/'</span> + id + <span class="hljs-string">'/file'</span>);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Sortable.utils.is(ctrl, <span class="hljs-string">".deleteJob"</span>)) {
      fabmo.deleteJob(id);

    }
  },

  onMove: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
    <span class="hljs-keyword">var</span> ctrl = evt.dragged;
    ctrl.removeAttribute(<span class="hljs-string">"style"</span>);
  },
  onEnd: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
    <span class="hljs-keyword">var</span> firstJob = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'queue_table'</span>).firstChild;
    <span class="hljs-keyword">var</span> cardActions = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">"div"</span>);
    setFirstCard();
    updateOrder();
    $(<span class="hljs-string">'.cancel'</span>).show(<span class="hljs-number">500</span>);
    $(<span class="hljs-string">'.download'</span>).show(<span class="hljs-number">500</span>);
    $(<span class="hljs-string">'.edit'</span>).show(<span class="hljs-number">500</span>);
    $(<span class="hljs-string">'.preview'</span>).show(<span class="hljs-number">500</span>);
    $(<span class="hljs-string">'.play-button'</span>).show();
  }
});


<span class="hljs-keyword">var</span> current_job_id = <span class="hljs-number">0</span>;


<span class="hljs-comment">////TOUR LOGIC //////</span>


<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setStep</span>(<span class="hljs-params">callback</span>) </span>{
  fabmo.getAppConfig(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) </span>{
    <span class="hljs-keyword">if</span> (data) {
      callback(data);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'no data'</span>)
    }
  });
}


<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">countStep</span>(<span class="hljs-params">step, callback</span>) </span>{
  fabmo.getAppConfig(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) </span>{
    <span class="hljs-keyword">if</span> (data) {
      <span class="hljs-keyword">if</span> (data.step &gt; -<span class="hljs-number">1</span>) {
        data.step = step;
        fabmo.setAppConfig(data, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) </span>{
          <span class="hljs-keyword">if</span> (err) {
            <span class="hljs-built_in">console</span>.log(err);
          } <span class="hljs-keyword">else</span> {
            callback(step);
          }
        });
      }
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'no data'</span>)
    }
  });
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stepOne</span>(<span class="hljs-params">step</span>) </span>{
  <span class="hljs-keyword">if</span> (step === <span class="hljs-number">0</span>) {
    $(<span class="hljs-string">'.no'</span>).hide();
    $(<span class="hljs-string">'.filter'</span>).show();
    $(<span class="hljs-string">'.tour-dialogue'</span>).show();
    $(<span class="hljs-string">'.tour-text'</span>).text(<span class="hljs-string">'Welcome to the Job Manager. This is where you will manage jobs. Jobs can exist in multiple states. The first we will talk about is a job that is queued.'</span>);
    $(<span class="hljs-string">'.next'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      step++;
      countStep(step, stepTwo);
    });
  } <span class="hljs-keyword">else</span> {
    $(<span class="hljs-string">'.no'</span>).hide();
    $(<span class="hljs-string">'.filter'</span>).show();
    $(<span class="hljs-string">'.tour-dialogue'</span>).show();
    stepTwo(step);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stepTwo</span>(<span class="hljs-params">step</span>) </span>{
  $(<span class="hljs-string">'.next'</span>).off();
  <span class="hljs-keyword">if</span> (step === <span class="hljs-number">1</span>) {
    $(<span class="hljs-string">'.tour-text'</span>).text(<span class="hljs-string">'A queued job is a job that is ready to run. If you have a job queued the job manager will tell you so by displaying "Up Next" in the top left of the screen.'</span>);
    $(<span class="hljs-string">'.up-next'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-number">2001</span>,
      <span class="hljs-string">'color'</span>: <span class="hljs-string">'#fff'</span>
    });
    $(<span class="hljs-string">'.next'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      step++;
      countStep(step, stepThree);
    });
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (step &gt; <span class="hljs-number">1</span>) {
    stepThree(step);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stepThree</span>(<span class="hljs-params">step</span>) </span>{

  $(<span class="hljs-string">'.next'</span>).off();
  <span class="hljs-keyword">if</span> (step === <span class="hljs-number">2</span>) {
    sortable.options.disabled = <span class="hljs-literal">true</span>;
    $(<span class="hljs-string">'.up-next'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-string">''</span>,
      <span class="hljs-string">'color'</span>: <span class="hljs-string">''</span>
    });
    $(<span class="hljs-string">'.tour-text'</span>).text(<span class="hljs-string">'This card represents the job and allows you to interact with it...'</span>);
    $(<span class="hljs-string">'.job_item:first-child'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-number">2001</span>
    });
    $(<span class="hljs-string">'#queue_table'</span>).unbind();
    $(<span class="hljs-string">'.tour-dialogue'</span>).css({
      <span class="hljs-string">'top'</span>: <span class="hljs-string">'70%'</span>
    });
    $(<span class="hljs-string">'.next'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      step++;
      countStep(step, stepFour);
    });
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (step &gt; <span class="hljs-number">2</span>) {
    sortable.options.disabled = <span class="hljs-literal">true</span>;
    $(<span class="hljs-string">'.up-next'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-string">'inherit'</span>,
      <span class="hljs-string">'color'</span>: <span class="hljs-string">'#666'</span>
    });
    $(<span class="hljs-string">'.tour-text'</span>).text(<span class="hljs-string">'This card represents the job and allows you to interact with it...'</span>);
    $(<span class="hljs-string">'.job_item:first-child'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-number">2001</span>
    });
    $(<span class="hljs-string">'#queue_table'</span>).unbind();
    $(<span class="hljs-string">'.tour-dialogue'</span>).css({
      <span class="hljs-string">'top'</span>: <span class="hljs-string">'70%'</span>
    });
    stepFour(step);
  }

}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stepFour</span>(<span class="hljs-params">step</span>) </span>{
  $(<span class="hljs-string">'.next'</span>).off();
  <span class="hljs-keyword">var</span> p = $(<span class="hljs-string">'.preview'</span>).offset();
  <span class="hljs-keyword">if</span> (step === <span class="hljs-number">3</span>) {
    $(<span class="hljs-string">'.tour-pointer'</span>).show();
    $(<span class="hljs-string">'.tour-pointer'</span>).css({
      <span class="hljs-string">'top'</span>: (p.top - <span class="hljs-number">50</span>),
      <span class="hljs-string">'left'</span>: p.left
    });
    $(<span class="hljs-string">'.next'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      step++;
      countStep(step, stepFive);
    });
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (step &gt; <span class="hljs-number">3</span>) {
    $(<span class="hljs-string">'.tour-pointer'</span>).show();
    stepFive(step);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stepFive</span>(<span class="hljs-params">step</span>) </span>{
  $(<span class="hljs-string">'.next'</span>).off();
  <span class="hljs-keyword">var</span> e = $(<span class="hljs-string">'.edit'</span>).offset();
  <span class="hljs-keyword">if</span> (step === <span class="hljs-number">4</span>) {
    $(<span class="hljs-string">'.tour-pointer'</span>).css({
      <span class="hljs-string">'top'</span>: (e.top - <span class="hljs-number">50</span>),
      <span class="hljs-string">'left'</span>: e.left
    });
    $(<span class="hljs-string">'.tour-pointer span'</span>).text(<span class="hljs-string">'You can edit the job'</span>);
    $(<span class="hljs-string">'.next'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      step++;
      countStep(step, stepSix);
    });
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (step &gt; <span class="hljs-number">4</span>) {
    $(<span class="hljs-string">'.tour-pointer span'</span>).text(<span class="hljs-string">'You can edit the job'</span>);
    stepSix(step);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stepSix</span>(<span class="hljs-params">step</span>) </span>{
  $(<span class="hljs-string">'.next'</span>).off();
  <span class="hljs-keyword">var</span> d = $(<span class="hljs-string">'.download'</span>).offset();
  <span class="hljs-keyword">if</span> (step === <span class="hljs-number">5</span>) {
    $(<span class="hljs-string">'.tour-pointer'</span>).css({
      <span class="hljs-string">'top'</span>: (d.top - <span class="hljs-number">50</span>),
      <span class="hljs-string">'left'</span>: d.left
    });
    $(<span class="hljs-string">'.tour-pointer span'</span>).text(<span class="hljs-string">'You can download the job'</span>);
    $(<span class="hljs-string">'.next'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      step++;
      countStep(step, stepSeven);
    });
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (step &gt; <span class="hljs-number">5</span>) {
    $(<span class="hljs-string">'.tour-pointer span'</span>).text(<span class="hljs-string">'You can download the job'</span>);
    stepSeven(step);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stepSeven</span>(<span class="hljs-params">step</span>) </span>{
  $(<span class="hljs-string">'.next'</span>).off();
  <span class="hljs-keyword">var</span> c = $(<span class="hljs-string">'.cancel'</span>).offset();
  <span class="hljs-keyword">if</span> (step === <span class="hljs-number">6</span>) {
    $(<span class="hljs-string">'.tour-pointer'</span>).css({
      <span class="hljs-string">'top'</span>: (c.top - <span class="hljs-number">50</span>),
      <span class="hljs-string">'left'</span>: c.left
    });
    $(<span class="hljs-string">'.tour-pointer span'</span>).text(<span class="hljs-string">'You can cancel the job'</span>);
    $(<span class="hljs-string">'.next'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      step++;
      countStep(step, stepEight);
    });
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (step &gt; <span class="hljs-number">6</span>) {
    $(<span class="hljs-string">'.tour-pointer span'</span>).text(<span class="hljs-string">'You can cancel the job'</span>);
    stepEight(step);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stepEight</span>(<span class="hljs-params">step</span>) </span>{
  $(<span class="hljs-string">'.next'</span>).off();
  <span class="hljs-keyword">if</span> (step === <span class="hljs-number">7</span>) {
    $(<span class="hljs-string">'.job_item:first-child'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-string">''</span>
    });
    $(<span class="hljs-string">'.tour-pointer'</span>).hide();
    $(<span class="hljs-string">'.tour-text'</span>).text(<span class="hljs-string">'Here we can tell the job by name'</span>);
    $(<span class="hljs-string">'.job_name'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-number">2001</span>,
      <span class="hljs-string">'color'</span>: <span class="hljs-string">'#fff'</span>
    });
    $(<span class="hljs-string">'.next'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      step++;
      countStep(step, stepNine);
    });
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (step &gt; <span class="hljs-number">7</span>) {
    $(<span class="hljs-string">'.job_item:first-child'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-string">''</span>
    });
    $(<span class="hljs-string">'.tour-pointer'</span>).hide();
    $(<span class="hljs-string">'.tour-text'</span>).text(<span class="hljs-string">'Here we can tell the job by name'</span>);
    $(<span class="hljs-string">'.job_name'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-number">2001</span>,
      <span class="hljs-string">'color'</span>: <span class="hljs-string">'#fff'</span>
    });
    stepNine(step);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stepNine</span>(<span class="hljs-params">step</span>) </span>{
  $(<span class="hljs-string">'.next'</span>).off();
  <span class="hljs-keyword">if</span> (step === <span class="hljs-number">8</span>) {
    $(<span class="hljs-string">'.job_name'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-string">''</span>,
      <span class="hljs-string">'color'</span>: <span class="hljs-string">''</span>
    });
    $(<span class="hljs-string">'.description'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-number">2001</span>,
      <span class="hljs-string">'color'</span>: <span class="hljs-string">'#fff'</span>
    });
    $(<span class="hljs-string">'.tour-text'</span>).text(<span class="hljs-string">'and get a short description of the job.'</span>);
    $(<span class="hljs-string">'.next'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      step++;
      countStep(step, stepTen);
    });
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (step &gt; <span class="hljs-number">8</span>) {
    $(<span class="hljs-string">'.job_name'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-string">'inherit'</span>,
      <span class="hljs-string">'color'</span>: <span class="hljs-string">'inherit'</span>
    });
    $(<span class="hljs-string">'.description'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-number">2001</span>,
      <span class="hljs-string">'color'</span>: <span class="hljs-string">'#fff'</span>
    });
    $(<span class="hljs-string">'.tour-text'</span>).text(<span class="hljs-string">'and get a short description of the job.'</span>);
    stepTen(step);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stepTen</span>(<span class="hljs-params">step</span>) </span>{
  $(<span class="hljs-string">'.next'</span>).off();
  <span class="hljs-keyword">if</span> (step === <span class="hljs-number">9</span>) {
    $(<span class="hljs-string">'.description'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-string">''</span>,
      <span class="hljs-string">'color'</span>: <span class="hljs-string">''</span>
    });
    $(<span class="hljs-string">'.tour-pointer'</span>).hide();
    $(<span class="hljs-string">'.tour-text'</span>).text(<span class="hljs-string">'Finally we can run a job by clicking the green "play" button. If you are ready go ahead and push it now to run your first job.'</span>);
    $(<span class="hljs-string">'.play-button'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-number">2001</span>
    });
    $(<span class="hljs-string">'.next'</span>).hide();
    runNext();
    <span class="hljs-keyword">var</span> finished = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">var</span> firstStatus = <span class="hljs-number">0</span>;
    fabmo.on(<span class="hljs-string">'status'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">status</span>) </span>{
      <span class="hljs-keyword">if</span> (status.state === <span class="hljs-string">"running"</span>) {
        $(<span class="hljs-string">'.tour-text'</span>).text(<span class="hljs-string">'Congrats! You are running your first job.'</span>);
        $(<span class="hljs-string">'.play-button'</span>).css({
          <span class="hljs-string">'z-index'</span>: <span class="hljs-number">2001</span>
        });
        $(<span class="hljs-string">'.next'</span>).hide();
        $(<span class="hljs-string">'.no'</span>).hide();
        finished = <span class="hljs-literal">true</span>;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (status.state === <span class="hljs-string">"idle"</span> &amp;&amp; finished === <span class="hljs-literal">true</span> &amp;&amp; firstStatus === <span class="hljs-number">0</span>) {
        firstStatus++;
        step++;
        countStep(step, stepEleven);
      }
    });
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (step &gt; <span class="hljs-number">9</span>) {
    stepEleven(step);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stepEleven</span>(<span class="hljs-params">step</span>) </span>{
  $(<span class="hljs-string">'.next'</span>).off();
  <span class="hljs-keyword">if</span> (step === <span class="hljs-number">10</span>) {
    $(<span class="hljs-string">'.tour-dialogue'</span>).css({
      <span class="hljs-string">'width'</span>: <span class="hljs-string">''</span>,
      <span class="hljs-string">'padding'</span>: <span class="hljs-string">''</span>,
      <span class="hljs-string">'top'</span>: <span class="hljs-string">''</span>
    });
    $(<span class="hljs-string">'.tour-text'</span>).text(<span class="hljs-string">'You ran your first Job! Would you like to continue to the tour of the Job Manager or explore on your own?'</span>);
    $(<span class="hljs-string">'.next'</span>).show();
    $(<span class="hljs-string">'.next'</span>).text(<span class="hljs-string">'Continue'</span>)
    $(<span class="hljs-string">'.no'</span>).show();
    $(<span class="hljs-string">'.next'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      step++;
      countStep(step, stepTwelve);
      fabmo.clearJobQueue(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) </span>{});
    })
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (step &gt; <span class="hljs-number">10</span>) {
    $(<span class="hljs-string">'.tour-dialogue'</span>).css({
      <span class="hljs-string">'width'</span>: <span class="hljs-string">''</span>,
      <span class="hljs-string">'padding'</span>: <span class="hljs-string">''</span>,
      <span class="hljs-string">'top'</span>: <span class="hljs-string">''</span>
    });
    $(<span class="hljs-string">'.next'</span>).show();
    $(<span class="hljs-string">'.next'</span>).text(<span class="hljs-string">'Continue'</span>)
    $(<span class="hljs-string">'.no'</span>).show();
    stepTwelve(step);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stepTwelve</span>(<span class="hljs-params">step</span>) </span>{
  $(<span class="hljs-string">'.next'</span>).off();
  <span class="hljs-keyword">if</span> (step === <span class="hljs-number">11</span>) {
    $(<span class="hljs-string">'.no'</span>).hide();
    $(<span class="hljs-string">'.next'</span>).text(<span class="hljs-string">'Next'</span>);
    $(<span class="hljs-string">'.tour-text'</span>).text(<span class="hljs-string">'Great now lets look what happens to a job after you run it.'</span>);
    $(<span class="hljs-string">'.next'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      step++;
      countStep(step, stepThirteen);
    });
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (step &gt; <span class="hljs-number">11</span>) {
    $(<span class="hljs-string">'.no'</span>).hide();
    $(<span class="hljs-string">'.next'</span>).text(<span class="hljs-string">'Next'</span>);
    stepThirteen(step);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stepThirteen</span>(<span class="hljs-params">step</span>) </span>{
  $(<span class="hljs-string">'.next'</span>).off();
  <span class="hljs-keyword">if</span> (step === <span class="hljs-number">12</span>) {
    $(<span class="hljs-string">'.tour-text'</span>).text(<span class="hljs-string">'Bellow you will see text for recent jobs. This will always show the most recent jobs you have run'</span>);
    $(<span class="hljs-string">'.no-job'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-number">2001</span>,
      <span class="hljs-string">'color'</span>: <span class="hljs-string">'#fff'</span>,
      <span class="hljs-string">'position'</span>: <span class="hljs-string">'relative'</span>
    });
    $(<span class="hljs-string">'.next'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      step++;
      countStep(step, stepFourteen);
    });
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (step &gt; <span class="hljs-number">12</span>) {
    $(<span class="hljs-string">'.no-job'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-number">2001</span>,
      <span class="hljs-string">'color'</span>: <span class="hljs-string">'#fff'</span>,
      <span class="hljs-string">'position'</span>: <span class="hljs-string">'relative'</span>
    });
    stepFourteen(step);
  }

}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stepFourteen</span>(<span class="hljs-params">step</span>) </span>{
  $(<span class="hljs-string">'.next'</span>).off();
  <span class="hljs-keyword">if</span> (step === <span class="hljs-number">13</span>) {
    $(<span class="hljs-string">'.tour-text'</span>).text(<span class="hljs-string">'This is the job you just ran'</span>);
    $(<span class="hljs-string">'.no-job'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-string">'inherit'</span>,
      <span class="hljs-string">'color'</span>: <span class="hljs-string">'#666'</span>
    });
    $(<span class="hljs-string">'.recent_item:first-child'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-number">2001</span>
    });

    $(<span class="hljs-string">'.next'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      step++;
      countStep(step, stepFifteen);
    });
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (step &gt; <span class="hljs-number">13</span>) {
    $(<span class="hljs-string">'.tour-text'</span>).text(<span class="hljs-string">'This is the job you just ran'</span>);
    $(<span class="hljs-string">'.no-job'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-string">'inherit'</span>,
      <span class="hljs-string">'color'</span>: <span class="hljs-string">'#666'</span>
    });
    $(<span class="hljs-string">'.recent_item:first-child'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-number">2001</span>
    });
    stepFifteen(step);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stepFifteen</span>(<span class="hljs-params">step</span>) </span>{
  $(<span class="hljs-string">'.next'</span>).off();
  <span class="hljs-keyword">if</span> (step === <span class="hljs-number">14</span>) {
    $(<span class="hljs-string">'.tour-text'</span>).text(<span class="hljs-string">'By clicking the up arrow you can re-run a job. This is useful when you are making a bunch of copies of the same job. (The arrow is disabled until you leave the tour.)'</span>);

    $(<span class="hljs-string">'.next'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      step++;
      countStep(step, stepSixteen);
    });
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (step &gt; <span class="hljs-number">14</span>) {
    $(<span class="hljs-string">'.tour-text'</span>).text(<span class="hljs-string">'By clicking the up arrow you can re-run a job. This is useful when you are making a bunch of copies of the same job. (The arrow is disabled until you leave the tour.)'</span>);
    stepSixteen(step);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stepSixteen</span>(<span class="hljs-params">step</span>) </span>{
  $(<span class="hljs-string">'.next'</span>).off();
  <span class="hljs-keyword">if</span> (step === <span class="hljs-number">15</span>) {
    $(<span class="hljs-string">'.recent_item:first-child'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-string">''</span>
    });
    $(<span class="hljs-string">'.tour-text'</span>).text(<span class="hljs-string">'All jobs will go into your job history. From there you can re-run, edit, permenently delete, or preview all old jobs'</span>);
    $(<span class="hljs-string">'#nav-history'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-number">2001</span>,
      <span class="hljs-string">'position'</span>: <span class="hljs-string">'relative'</span>
    });
    $(<span class="hljs-string">'.next'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      step++;
      countStep(step, stepSeventeen);
    });
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (step &gt; <span class="hljs-number">15</span>) {
    $(<span class="hljs-string">'.recent_item:first-child'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-string">''</span>
    });
    $(<span class="hljs-string">'.tour-text'</span>).text(<span class="hljs-string">'All jobs will go into your job history. From there you can re-run, edit, permenently delete, or preview all old jobs'</span>);
    $(<span class="hljs-string">'#nav-history'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-number">2001</span>,
      <span class="hljs-string">'position'</span>: <span class="hljs-string">'relative'</span>
    });
    stepSeventeen(step);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stepSeventeen</span>(<span class="hljs-params">step</span>) </span>{
  $(<span class="hljs-string">'.next'</span>).off();
  <span class="hljs-keyword">if</span> (step === <span class="hljs-number">16</span>) {
    $(<span class="hljs-string">'#nav-history'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-string">''</span>,
      <span class="hljs-string">'position'</span>: <span class="hljs-string">''</span>
    });
    $(<span class="hljs-string">'.tour-text'</span>).text(<span class="hljs-string">'There are two ways to submit a new job, first you can click the "Submit Jobs..." tab and search through your files.'</span>);
    $(<span class="hljs-string">'#nav-submit'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-number">2001</span>,
      <span class="hljs-string">'position'</span>: <span class="hljs-string">'relative'</span>
    });

    $(<span class="hljs-string">'.next'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      step++;
      countStep(step, stepEighteen);
    });
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (step &gt; <span class="hljs-number">16</span>) {
    $(<span class="hljs-string">'#nav-history'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-string">'inherit'</span>,
      <span class="hljs-string">'position'</span>: <span class="hljs-string">'inherit'</span>
    });
    $(<span class="hljs-string">'.tour-text'</span>).text(<span class="hljs-string">'There are two ways to submit a new job, first you can click the "Submit Jobs..." tab and search through your files.'</span>);
    $(<span class="hljs-string">'#nav-submit'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-number">2001</span>,
      <span class="hljs-string">'position'</span>: <span class="hljs-string">'relative'</span>
    });
    stepEighteen(step);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stepEighteen</span>(<span class="hljs-params">step</span>) </span>{
  $(<span class="hljs-string">'.next'</span>).off();
  <span class="hljs-keyword">if</span> (step === <span class="hljs-number">17</span>) {
    $(<span class="hljs-string">'#nav-submit'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-string">'inherit'</span>,
      <span class="hljs-string">'position'</span>: <span class="hljs-string">'inherit'</span>
    });
    $(<span class="hljs-string">'.without-job'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-number">2001</span>,
      <span class="hljs-string">'position'</span>: <span class="hljs-string">'relative'</span>
    });
    $(<span class="hljs-string">'.tour-dialogue'</span>).css({
      <span class="hljs-string">'top'</span>: <span class="hljs-string">'60%'</span>
    });
    $(<span class="hljs-string">'.tour-text'</span>).text(<span class="hljs-string">'Second if you have your job handy you can just drag and drop it here'</span>);

    $(<span class="hljs-string">'.next'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      step++;
      countStep(step, stepNineteen);
    });
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (step &gt; <span class="hljs-number">17</span>) {
    $(<span class="hljs-string">'#nav-submit'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-string">'inherit'</span>,
      <span class="hljs-string">'position'</span>: <span class="hljs-string">'inherit'</span>
    });
    $(<span class="hljs-string">'.without-job'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-number">2001</span>,
      <span class="hljs-string">'position'</span>: <span class="hljs-string">'relative'</span>
    });
    $(<span class="hljs-string">'.tour-dialogue'</span>).css({
      <span class="hljs-string">'top'</span>: <span class="hljs-string">'60%'</span>
    });
    $(<span class="hljs-string">'.tour-text'</span>).text(<span class="hljs-string">'Second if you have your job handy you can just drag and drop it here'</span>);
    stepNineteen(step);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stepNineteen</span>(<span class="hljs-params">step</span>) </span>{
  $(<span class="hljs-string">'.next'</span>).off();
  <span class="hljs-keyword">if</span> (step === <span class="hljs-number">18</span>) {
    sortable.options.disabled = <span class="hljs-literal">false</span>;
    $(<span class="hljs-string">'.tour-dialogue'</span>).css({
      <span class="hljs-string">'top'</span>: <span class="hljs-string">''</span>
    });
    $(<span class="hljs-string">'.without-job'</span>).css({
      <span class="hljs-string">'z-index'</span>: <span class="hljs-string">'inherit'</span>
    });
    $(<span class="hljs-string">'.tour-text'</span>).text(<span class="hljs-string">'Congratulations! Those are the basic functions of the Job Manager. Would you now like help getting your tool on your network?'</span>);
    $(<span class="hljs-string">'.no'</span>).show();
    $(<span class="hljs-string">'.next'</span>).text(<span class="hljs-string">'Yes'</span>);
    step++;
    countStep(step, tourDone);
    $(<span class="hljs-string">'.next'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      fabmo.launchApp(<span class="hljs-string">'network-manager'</span>);
      $(<span class="hljs-string">'.filter'</span>).hide();
      $(<span class="hljs-string">'.tour-dialogue'</span>).hide();
    });
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (step &gt; <span class="hljs-number">18</span>) {
    $(<span class="hljs-string">'.filter'</span>).hide();
    $(<span class="hljs-string">'.tour-dialogue'</span>).hide();

  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">tourDone</span>(<span class="hljs-params">step</span>) </span>{
  sortable.options.disabled = <span class="hljs-literal">false</span>;
  tourComplete = <span class="hljs-literal">true</span>;
  cameFromTour = <span class="hljs-literal">false</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">tour</span>(<span class="hljs-params">data</span>) </span>{
  <span class="hljs-keyword">if</span> (data.step &gt; -<span class="hljs-number">1</span>) {
    step = data.step;
  } <span class="hljs-keyword">else</span> {
    step = <span class="hljs-number">0</span>;
    data.step = step;
    fabmo.setAppConfig(data, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) </span>{});
  }


  <span class="hljs-keyword">if</span> (tourComplete === <span class="hljs-literal">false</span> &amp;&amp; cameFromTour === <span class="hljs-literal">true</span> &amp;&amp; numberJobs === <span class="hljs-number">1</span>) {
    $(<span class="hljs-string">'.no'</span>).off();
    $(<span class="hljs-string">'.no'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      $(<span class="hljs-string">'.filter'</span>).hide();
      $(<span class="hljs-string">'.tour-dialogue'</span>).hide();
      sortable.options.disabled = <span class="hljs-literal">false</span>;
      tourDone();
    });
    stepOne(step);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">runNext</span>(<span class="hljs-params"></span>) </span>{
  $(<span class="hljs-string">'#queue_table'</span>).on(<span class="hljs-string">'click touchstart'</span>, <span class="hljs-string">'.play'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    <span class="hljs-keyword">if</span> ($(<span class="hljs-string">'.play'</span>).hasClass(<span class="hljs-string">'active'</span>)) {
      fabmo.pause(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) </span>{});
    } <span class="hljs-keyword">else</span> {
      jobLoading = <span class="hljs-literal">true</span>; 
      $(<span class="hljs-string">'.play'</span>).addClass(<span class="hljs-string">'loading'</span>);
      fabmo.runNext(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) </span>{
        <span class="hljs-keyword">if</span> (err) {
          fabmo.notify(err);
        } <span class="hljs-keyword">else</span> {
        }
      });
    }
  });
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">findUpTag</span>(<span class="hljs-params">el, id</span>) </span>{
  <span class="hljs-keyword">while</span> (el.parentNode) {
    el = el.parentNode;
    <span class="hljs-keyword">if</span> (el.id === id)
      <span class="hljs-keyword">return</span> el;
  }
  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}

<span class="hljs-comment">//function determining  arguments submitted from other apps</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setup</span>(<span class="hljs-params"></span>) </span>{
  fabmo.getAppArgs(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, args</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-string">'from_tour'</span> <span class="hljs-keyword">in</span> args) {
      cameFromTour = <span class="hljs-literal">true</span>;
      tourComplete = <span class="hljs-literal">false</span>;
    };

  });
}

$(<span class="hljs-built_in">document</span>).ready(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-comment">//Foundation Init</span>

  setup();

  $(<span class="hljs-built_in">document</span>).foundation();


  fabmo.on(<span class="hljs-string">'job_end'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">cmd</span>) </span>{
    updateQueue();
    updateHistory();
  });

   fabmo.on(<span class="hljs-string">'job_start'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">cmd, data</span>) </span>{
    updateQueue();
    updateHistory();
  });


  <span class="hljs-comment">//May need to put back in </span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>fabmo.on(&#39;change&#39;,function (change) {
  if(change === &quot;jobs&quot;) {
    updateQueue();
    updateHistory();
  }</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-comment">// );</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Request infoes from the tool</p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The queue will update when the status report comes in
But the history needs to be updated manually</p></div></div><div class="code"><div class="wrapper">  fabmo.requestStatus();
  updateQueue();
  updateHistory();

  setupDropTarget();
  runNext();

  $(<span class="hljs-string">'#history_page_next'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
    evt.preventDefault();
    historyNextPage();
  });

  $(<span class="hljs-string">'#history_page_prev'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
    evt.preventDefault();
    historyPreviousPage();
  });

  $(<span class="hljs-string">'.no-jobs-item'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    $(<span class="hljs-string">'#job_selector'</span>).click();
  });

  $(<span class="hljs-string">'#clear-jobs'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    fabmo.clearJobQueue(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) </span>{
      updateQueue();
    });
  });

  $(<span class="hljs-string">'.submit-button'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
    jQuery(<span class="hljs-string">'#file'</span>).trigger(<span class="hljs-string">'click'</span>);
  });

  $(<span class="hljs-string">'.without-job'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
    jQuery(<span class="hljs-string">'#file'</span>).trigger(<span class="hljs-string">'click'</span>);
  });

  $(<span class="hljs-string">'#file'</span>).change(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
    <span class="hljs-keyword">var</span> file_size = $(<span class="hljs-string">'#fileform'</span>).find(<span class="hljs-string">'input:file'</span>)[<span class="hljs-number">0</span>].files[<span class="hljs-number">0</span>].size;
    $(<span class="hljs-string">'.progressbar'</span>).removeClass(<span class="hljs-string">'hide'</span>);
    fabmo.on(<span class="hljs-string">'upload_progress'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">progress</span>) </span>{
      fileUploadProgress(progress.value);
    });
    fabmo.submitJob($(<span class="hljs-string">'#fileform'</span>), {
      compressed: file_size &gt; <span class="hljs-number">2000000</span> ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>
    }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) </span>{
      <span class="hljs-keyword">if</span> (err) {
        fabmo.notify(<span class="hljs-string">'error'</span>, err);
      }
      resetFormElement($(<span class="hljs-string">'#file'</span>));
      updateQueue();
      updateOrder();
      $(<span class="hljs-string">'#nav-pending'</span>).click();
    });
  });</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>$( window ).resize(function() {
    setJobheight();</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-comment">// ).resize();</span>
  fabmo.on(<span class="hljs-string">'reconnect'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    updateQueue();
    updateOrder();
    updateHistory();
  });



  fabmo.on(<span class="hljs-string">'status'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">status</span>) </span>{
    handleStatusReport(status);
    <span class="hljs-keyword">if</span> (status.job == <span class="hljs-literal">null</span> &amp;&amp; status.state != <span class="hljs-string">'idle'</span>) {
      $(<span class="hljs-string">'.play-button'</span>).hide();
      $(<span class="hljs-string">'.play'</span>).removeClass(<span class="hljs-string">'loading'</span>);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (status.state == <span class="hljs-string">'idle'</span> &amp;&amp; el.firstChild) {
      $(<span class="hljs-string">'.play-button'</span>).show();
    } 

  });

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resetFormElement</span>(<span class="hljs-params">e</span>) </span>{
    e.wrap(<span class="hljs-string">'&lt;form&gt;'</span>).closest(<span class="hljs-string">'form'</span>).get(<span class="hljs-number">0</span>).reset();
    e.unwrap();
  }





});</div></div></div></div></body></html>